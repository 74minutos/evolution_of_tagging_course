<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La EvoluciÃ³n del Tagging</title>
    <meta name="description" content="Una guÃ­a interactiva sobre Google Tag Manager y por quÃ© lo necesitas">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/main.css?v=117">
    <style>
      @import "@fontsource/inter/400.css";
      @import "@fontsource/inter/500.css";
      @import "@fontsource/inter/600.css";
      @import "@fontsource/inter/700.css";
      @import "../styles/modern-theme.css";
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div id="loading">
        <div class="loader">Cargando...</div>
    </div>

    <!-- Main content -->
    <div id="content" class="scene-root">
        
        <!-- Teacher Mode Bar (top) -->
        <div id="teacher-bar" class="teacher-bar" style="display: none;">
            <div class="teacher-controls">
                <button class="teacher-btn" onclick="previousSection()" title="Anterior (â†)">
                    â—„ Anterior
                </button>
                <button class="teacher-btn" id="pause-btn" onclick="togglePause()" title="Pausar (Espacio)">
                    â¸ Pausar
                </button>
                <button class="teacher-btn" onclick="nextSection()" title="Siguiente (â†’)">
                    Siguiente â–º
                </button>
                <span class="teacher-divider">|</span>
                <button class="teacher-btn" onclick="toggleNav()" title="MenÃº (M)">
                    â˜° MenÃº
                </button>
                <button class="teacher-btn" onclick="toggleProjectorMode()" title="Proyector (P)">
                    ğŸ–¥ Proyector
                </button>
                <button class="teacher-btn" onclick="toggleDevTools()" title="Dev Tools (D)">
                    ğŸ”§ Dev Tools
                </button>
            </div>
            <div class="teacher-info">
                <span id="teacher-progress">Cap. 1/3</span>
                <button class="teacher-btn-close" onclick="toggleTeacherMode()" title="Cerrar (T)">Ã—</button>
            </div>
        </div>
        
        <!-- Dev Tools Panel -->
        <div id="dev-tools" class="dev-tools-panel" style="display: none;">
            <div class="dev-tools-header">
                <h3>ğŸ”§ Dev Tools - NavegaciÃ³n RÃ¡pida</h3>
                <button class="nav-close" onclick="toggleDevTools()">Ã—</button>
            </div>
            <div class="dev-tools-content">
                <div class="dev-section">
                    <h4>ğŸ¬ SECCIÃ“N 0: Â¿QuÃ© es GTM?</h4>
                    <button class="dev-btn" onclick="jumpToSection('intro-section-0-welcome')">Inicio: Â¿QuÃ© es GTM?</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-section-0-definition')">DefiniciÃ³n</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-section-0-problem')">El problema: Sin GTM</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-section-0-solution')">La soluciÃ³n: Con GTM</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-section-0-impact')">Impacto: NÃºmeros reales</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ“š Bloque 1: Tu primer dÃ­a</h4>
                    <button class="dev-btn" onclick="jumpToSection('intro-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-rpg-dialog')">RPG Dialog</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-1')">TeorÃ­a 1: QuÃ© es GTM</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-expandible-1')">Pop-up: DefiniciÃ³n GTM</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-2')">TeorÃ­a 2: Los 3 Pilares</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-tower-game')">Juego: Torre de control</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-3')">TeorÃ­a 3: Ecosistema</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-mission-2')">MisiÃ³n 2: Primer evento</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-expandible-2')">Pop-up: GTM en el mundo real</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-4')">TeorÃ­a 4: Beneficios</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-theory-expandible-3')">Pop-up: Poder estratÃ©gico</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-quiz-game')">Quiz: Prueba del marketer</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-secretos')">Secretos que nadie te cuenta</button>
                    <button class="dev-btn" onclick="jumpToSection('intro-final')">Final Bloque 1</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ—£ï¸ Bloque 2: El lenguaje secreto</h4>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-intro-datalayer')">Â¿QuÃ© es el dataLayer?</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-expandible-1')">Pop-up: Fundamentos</button>
            <button class="dev-btn" onclick="showScene('introSections', 'bloque2-theory-1')">AnatomÃ­a de eventos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-game-1')">Juego: DataLayer</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-2')">Tipos de Triggers</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-game-2')">Juego: Construir trigger</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-expandible-2')">Pop-up: GuÃ­a Variables</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-3')">Variables</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-game-3')">Juego: SelecciÃ³n Variable</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-expandible-3')">Pop-up: GuÃ­a Tags</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-4')">Tags</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-game-4')">Juego: Configurar Tag</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-5')">Debugging y QA</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-game-5')">Juego: Debugging Challenge</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-theory-6')">Estrategia y Naming</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-boss-fight')">Boss Fight</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-checklist')">Checklist implementaciÃ³n</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque2-final')">Final Bloque 2</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ‘ï¸ Bloque 3: El ojo que todo lo ve</h4>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-theory-1')">Por quÃ© validar</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-mission-1')">MisiÃ³n 1: Encender la luz</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-theory-2')">Herramientas QA</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-mission-2')">MisiÃ³n 2: Evento fantasma</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-theory-3')">ValidaciÃ³n cruzada</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-mission-3')">MisiÃ³n 3: Sigue el rastro</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-theory-4')">Validar en entornos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-mission-4')">MisiÃ³n 4: Bug de staging</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-theory-5')">QA + Marketing</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-boss-fight')">Boss Fight</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque3-final')">Final Bloque 3</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ¬ Demo Live: GTM en AcciÃ³n</h4>
                    <button class="dev-btn" onclick="jumpToSection('demo-welcome')">Intro Demos</button>
                    <button class="dev-btn" onclick="jumpToSection('demo-facebook')">Meta Pixel (Facebook)</button>
                    <button class="dev-btn" onclick="jumpToSection('demo-ga4')">GA4 Lead & E-commerce</button>
                    <button class="dev-btn" onclick="jumpToSection('demo-capi')">Meta CAPI (Server-side)</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ—ï¸ Bloque 4 â€” Arquitectos del Funnel</h4>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-theory-1')">TeorÃ­a: QuÃ© es un funnel</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-mission-1')">MisiÃ³n 1: Evento faltante</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-theory-2')">TeorÃ­a: CÃ³mo mapear</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-mission-2')">MisiÃ³n 2: Mapear eventos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-theory-3')">TeorÃ­a: Estructura tÃ©cnica</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-mission-3')">MisiÃ³n 3: Detectar funnel roto</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-theory-4')">TeorÃ­a: Naming</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-mission-4')">MisiÃ³n 4: Normalizar eventos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-theory-5')">TeorÃ­a: Medir embudos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-mission-5')">MisiÃ³n 5: Detective de embudos</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-boss-fight')">Boss Fight</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque4-final')">Final Bloque 4</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ§ Bloque 5 â€” Escuchar al Dato</h4>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-game-1')">MisiÃ³n 1: AtribuciÃ³n</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-theory-2')">TeorÃ­a: Herramientas para escuchar</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-game-2')">MisiÃ³n 2: Funnels</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-theory-3')">TeorÃ­a: Datos a decisiones</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-game-3')">MisiÃ³n 3: Insight accionable</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-theory-4')">TeorÃ­a: Dashboard narrativo</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-boss-fight')">Boss Fight: Dashboard</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque5-final')">Final Bloque 5</button>
                </div>
                <div class="dev-section">
                    <h4>ğŸ”’ Bloque 6 â€” Server-side GTM</h4>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-welcome')">Bienvenida</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-theory-1')">Client vs Server</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-theory-2')">GTM Server Container</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-theory-3')">Meta CAPI</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-theory-4')">Consent Mode y GDPR</button>
                    <button class="dev-btn" onclick="jumpToSection('bloque6-final')">Final / CertificaciÃ³n</button>
                </div>
            </div>
        </div>

        <!-- Side Navigation -->
        <nav id="side-nav" class="side-nav" style="display: none;">
            <div class="nav-header">
                <h3>CapÃ­tulos</h3>
                <button class="nav-close" onclick="toggleNav()">Ã—</button>
            </div>
            <ul class="nav-list">
                <li><a href="#" onclick="jumpToChapter(0)" class="nav-item active">Inicio</a></li>
                <li><a href="#" onclick="jumpToChapter(1)" class="nav-item">1. El Caos Antes de GTM</a></li>
                <li><a href="#" onclick="jumpToChapter(2)" class="nav-item">2. Ordenando la Casa</a></li>
                <li><a href="#" onclick="jumpToChapter(3)" class="nav-item">3. Gobernanza</a></li>
                <li><a href="#" onclick="jumpToChapter(4)" class="nav-item">4. La Ley ğŸš§</a></li>
                <li><a href="#" onclick="jumpToChapter(5)" class="nav-item">5. Integraciones ğŸš§</a></li>
                <li><a href="#" onclick="jumpToChapter(6)" class="nav-item">6. Server-side ğŸš§</a></li>
                <li><a href="#" onclick="jumpToChapter(7)" class="nav-item">7. Orquestar ğŸš§</a></li>
            </ul>
            <div class="nav-resources">
                <h4>ğŸ“š Recursos</h4>
                <ul>
                    <li><a href="slides/EDEM - GTM I-2.pdf" target="_blank">ğŸ“Š Slides GTM I</a></li>
                    <li><a href="slides/EDEM - GTM II-2.pdf" target="_blank">ğŸ“Š Slides GTM II</a></li>
                    <li><a href="#" onclick="showTheoryModal('intro'); return false;">ğŸ’¡ Ver Conceptos Clave</a></li>
                </ul>
            </div>
            
            <div class="nav-shortcuts">
                <h4>Atajos de Teclado</h4>
                <ul>
                    <li><kbd>T</kbd> - Modo Presentador</li>
                    <li><kbd>P</kbd> - Vista Proyector</li>
                    <li><kbd>M</kbd> - MenÃº</li>
                    <li><kbd>â†</kbd> <kbd>â†’</kbd> - Navegar</li>
                    <li><kbd>1</kbd> <kbd>2</kbd> - Elegir opciones</li>
                </ul>
            </div>
        </nav>

        <!-- Theory Modal -->
        <div id="theory-modal" class="theory-modal" style="display: none;">
            <div class="theory-modal-content">
                <button class="theory-close" onclick="closeTheoryModal()">Ã—</button>
                <div id="theory-content"></div>
                <div class="theory-nav">
                    <button class="btn-theory" onclick="prevTheorySlide()">â† Anterior</button>
                    <span id="theory-progress">1/3</span>
                    <button class="btn-theory" onclick="nextTheorySlide()">Siguiente â†’</button>
                </div>
            </div>
        </div>

        <!-- Teacher Notes Panel (hidden by default) -->
        <div id="teacher-notes" class="teacher-notes" style="display: none;">
            <button class="notes-close" onclick="hideTeacherNotes()">Ã—</button>
            <h3>ğŸ“ Notas del Profesor</h3>
            <div id="teacher-notes-content"></div>
        </div>

        <!-- Title Screen -->
        <section id="title-screen" class="screen active">
            <div class="center-content">
                <div class="title-hero">
                <h1 class="main-title">
                    <span class="title-small">LA</span><br>
                    EVOLUCIÃ“N<br>
                    <span class="title-small">DEL TAGGING</span>
                </h1>
                <p class="subtitle">
                        Aprende Google Tag Manager de forma interactiva
                </p>
                    
                <div class="game-stats">
                    <div class="stat-box">
                            <span class="stat-icon">ğŸ“š</span>
                            <span class="stat-label">Bloques</span>
                            <span class="stat-value">6</span>
                    </div>
                    <div class="stat-box">
                            <span class="stat-icon">ğŸ¬</span>
                            <span class="stat-label">Demos Live</span>
                            <span class="stat-value">3</span>
                    </div>
                    <div class="stat-box">
                            <span class="stat-icon">ğŸ®</span>
                            <span class="stat-label">Minijuegos</span>
                            <span class="stat-value">15+</span>
                    </div>
                        <div class="stat-box">
                            <span class="stat-icon">ğŸ†</span>
                            <span class="stat-label">Logros</span>
                            <span class="stat-value">19</span>
                </div>
                    </div>

                    <div class="title-blocks-preview">
                        <div class="block-preview">
                            <span class="block-icon">ğŸ¯</span>
                            <span class="block-name">Â¿QuÃ© es GTM?</span>
                        </div>
                        <div class="block-preview">
                            <span class="block-icon">ğŸ—ï¸</span>
                            <span class="block-name">La Torre</span>
                        </div>
                        <div class="block-preview">
                            <span class="block-icon">ğŸ—£ï¸</span>
                            <span class="block-name">Eventos</span>
                        </div>
                        <div class="block-preview">
                            <span class="block-icon">ğŸ‘ï¸</span>
                            <span class="block-name">ValidaciÃ³n</span>
                        </div>
                        <div class="block-preview">
                            <span class="block-icon">ğŸ“Š</span>
                            <span class="block-name">Funnels</span>
                        </div>
                        <div class="block-preview">
                            <span class="block-icon">ğŸ”’</span>
                            <span class="block-name">Server-side</span>
                        </div>
                    </div>

                <button class="btn-primary btn-game-start" onclick="startJourney()">
                        COMENZAR AVENTURA â†’
                </button>
                    
                    <p class="title-author">
                        Por Jorge CarriÃ³n Â· EDEM
                </p>
                </div>
            </div>
        </section>
        
        <!-- Game HUD (overlay) -->
        <div id="game-hud" class="game-hud" style="display: none;">
            <div class="hud-left">
                <div class="player-info">
                    <div class="player-avatar">ğŸ“</div>
                    <div class="player-details">
                        <div class="player-name">Aprendiz</div>
                        <div class="player-level">Nivel <span id="player-level">1</span></div>
                    </div>
                </div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                    <span class="xp-text"><span id="xp-current">0</span> / <span id="xp-max">100</span> XP</span>
                </div>
            </div>
            <div class="hud-right">
                <button class="hud-btn" onclick="toggleAchievements()" title="Logros">
                    ğŸ† <span id="achievement-count">0/19</span>
                </button>
            </div>
        </div>
        
        <!-- Achievement Notification -->
        <div id="achievement-notification" class="achievement-notification">
            <div class="achievement-icon">ğŸ†</div>
            <div class="achievement-details">
                <div class="achievement-title">Â¡Logro Desbloqueado!</div>
                <div class="achievement-name" id="achievement-name"></div>
                <div class="achievement-xp">+<span id="achievement-xp">0</span> XP</div>
            </div>
        </div>
        
        <!-- Achievements Panel -->
        <div id="achievements-panel" class="achievements-panel" style="display: none;">
            <div class="achievements-content">
                <div class="achievements-header">
                    <h2>ğŸ† Tus Logros</h2>
                    <button class="close-btn" onclick="toggleAchievements()">Ã—</button>
                </div>
                <div id="achievements-list" class="achievements-list">
                    <!-- Achievements will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Main article container -->
        <article id="main-story" style="display: none;">
            <!-- Introduction: Multiple scenes -->

            <!-- SECCIÃ“N 0: Â¿QUÃ‰ ES GTM Y POR QUÃ‰ TE IMPORTA? -->
            <section class="chapter intro-scene-section" id="intro-section-0-welcome" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h1>Â¿QuÃ© es GTM?</h1>
            <span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text);">â±ï¸ ~5 min</span>
            <p style="font-size: 1.1rem; max-width: 800px; margin: var(--space-lg) auto; text-align: center; color: var(--text-light);">
                Antes de aprender a USAR GTM, necesitas entender QUÃ‰ es y POR QUÃ‰ lo necesitas.
            </p>

            <button class="intro-cta" onclick="jumpToSection('intro-section-0-definition')" style="margin-top: var(--space-lg);">
                <span>Empecemos</span>
                <span>â†’</span>
            </button>
            </div>
            </div>
</section>

            <!-- SECCIÃ“N 0: DEFINICIÃ“N -->
            <section class="chapter intro-scene-section" id="intro-section-0-definition" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>DefiniciÃ³n: Google Tag Manager</h2>
            <span class="intro-pill">Concepto fundamental</span>

            <div class="intro-card-motion" style="text-align: left; margin: var(--space-lg) 0;">
                <blockquote style="border-left: 4px solid var(--primary); padding-left: var(--space-md); font-style: italic; font-size: 1.15rem; margin: 0;">
                    "Un Tag Manager es una herramienta que simplifica la inserciÃ³n de scripts, cÃ³digo HTML y de otras herramientas en un sitio web, generalmente con propÃ³sitos de marketing."
                </blockquote>
                <p style="margin-top: var(--space-md); font-size: 0.95rem; color: var(--text-light);">
                    â€” DefiniciÃ³n oficial de Google
                </p>
            </div>

            <div class="intro-grid-3" style="margin-top: var(--space-xl);">
                <article class="intro-card-motion">
                    <h3>ğŸ”§ TÃ©cnicamente</h3>
                    <p>Es una plataforma que centraliza la gestiÃ³n de etiquetas (tags) y permite controlar cuÃ¡ndo se ejecuta cada una.</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ’¼ Comercialmente</h3>
                    <p>Es el intermediario entre tu web y las plataformas de marketing (GA4, Meta, Google Ads, etc.)</p>
                </article>
                <article class="intro-card-motion">
                    <h3>âš¡ Operacionalmente</h3>
                    <p>Es lo que te permite lanzar campaÃ±as sin bloquear a desarrollo en cada cambio.</p>
                </article>
        </div>

            <button class="intro-cta" onclick="jumpToSection('intro-section-0-problem')" style="margin-top: var(--space-lg);">
                <span>Ver el problema que resuelve</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

            <!-- SECCIÃ“N 0: EL PROBLEMA SIN GTM -->
            <section class="chapter intro-scene-section" id="intro-section-0-problem" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>El Problema: Sin GTM</h2>
            <span class="intro-pill">La vida real de 2011</span>

            <p style="font-size: 1.05rem; max-width: 760px; margin: var(--space-lg) auto;">
                Imagina que cada herramienta que quieres usar requiere insertar cÃ³digo directamente en tu web:
            </p>

            <div style="background: rgba(229, 115, 115, 0.1); border-left: 4px solid #e57373; padding: var(--space-lg); border-radius: 12px; margin: var(--space-xl) 0;">
                <h3 style="color: #e57373; margin-top: 0;">ğŸ“‹ Flujo sin GTM:</h3>
                <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                    <div class="intro-step">
                        <span class="intro-step-bullet">1</span>
                        <div><strong>Marketer solicita:</strong> "Necesito trackear clics en el botÃ³n de compra"</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">2</span>
                        <div><strong>Dev recibe:</strong> ticket, lo aÃ±ade a la cola (hay 47 mÃ¡s)</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">3</span>
                        <div><strong>Dev codifica:</strong> inserta script de GA4 en HTML</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">4</span>
                        <div><strong>QA revisa:</strong> testing en dev, staging, producciÃ³n</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">5</span>
                        <div><strong>Deploy:</strong> se deploya a producciÃ³n (espera a la siguiente ventana)</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">6</span>
                        <div><strong>Resultado:</strong> 7-14 dÃ­as despuÃ©s, el evento ya funciona</div>
                    </div>
                </div>
            </div>

            <div style="margin: var(--space-xl) 0;">
                <h3>âŒ Los problemas:</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: var(--space-md) 0;">ğŸŒ <strong>Lentitud:</strong> Una semana para un solo cambio</li>
                    <li style="margin: var(--space-md) 0;">ğŸ‘¥ <strong>Dependencia:</strong> Marketing siempre espera a dev</li>
                    <li style="margin: var(--space-md) 0;">ğŸ’¥ <strong>Riesgo:</strong> Cada cambio requiere deploy (riesgo de romper cosas)</li>
                    <li style="margin: var(--space-md) 0;">ğŸ“Š <strong>Datos inconsistentes:</strong> Diferentes equipos implementan de formas diferentes</li>
                    <li style="margin: var(--space-md) 0;">ğŸ’° <strong>Coste:</strong> Dev dedicando horas a tareas repetitivas</li>
                </ul>
            </div>

            <button class="intro-cta" onclick="jumpToSection('intro-section-0-solution')" style="margin-top: var(--space-lg);">
                <span>Ver la soluciÃ³n</span>
                <span>â†’</span>
            </button>
        </div>
    </div>
</section>

            <!-- SECCIÃ“N 0: LA SOLUCIÃ“N CON GTM -->
            <section class="chapter intro-scene-section" id="intro-section-0-solution" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>La SoluciÃ³n: Con GTM</h2>
            <span class="intro-pill">El futuro (desde 2012)</span>

            <p style="font-size: 1.05rem; max-width: 760px; margin: var(--space-lg) auto;">
                Con GTM, el flujo es completamente diferente:
            </p>

            <div style="background: rgba(123, 201, 111, 0.1); border-left: 4px solid #7bc96f; padding: var(--space-lg); border-radius: 12px; margin: var(--space-xl) 0;">
                <h3 style="color: #7bc96f; margin-top: 0;">âœ… Flujo con GTM:</h3>
                <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                    <div class="intro-step">
                        <span class="intro-step-bullet">1</span>
                        <div><strong>Marketer:</strong> "Necesito trackear clics en el botÃ³n de compra"</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">2</span>
                        <div><strong>Marketer en GTM:</strong> Crea un trigger "Click en #buy-button"</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">3</span>
                        <div><strong>Marketer en GTM:</strong> Crea un tag "GA4 - Purchase Click"</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">4</span>
                        <div><strong>Marketer en GTM:</strong> Conecta trigger + tag</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">5</span>
                        <div><strong>Preview:</strong> Prueba en modo preview antes de publicar</div>
                    </div>
                    <div class="intro-step">
                        <span class="intro-step-bullet">6</span>
                        <div><strong>Resultado:</strong> 10 minutos, sin tocar dev, sin deploy</div>
                    </div>
                </div>
            </div>

            <div style="margin: var(--space-xl) 0;">
                <h3>âœ… Las ventajas:</h3>
                <div class="intro-grid">
                    <article class="intro-card-motion">
                        <h4>âš¡ Velocidad</h4>
                        <p>De 7-14 dÃ­as a 10 minutos</p>
                    </article>
                    <article class="intro-card-motion">
                        <h4>ğŸ¯ AutonomÃ­a</h4>
                        <p>Marketing no depende de dev</p>
                    </article>
                    <article class="intro-card-motion">
                        <h4>ğŸ›¡ï¸ Seguridad</h4>
                        <p>Preview mode antes de publicar</p>
                    </article>
                    <article class="intro-card-motion">
                        <h4>ğŸ“Š Consistencia</h4>
                        <p>Todos usan la misma herramienta</p>
                    </article>
                    <article class="intro-card-motion">
                        <h4>ğŸ’° Eficiencia</h4>
                        <p>Dev hace cosas mÃ¡s importantes</p>
                    </article>
                    <article class="intro-card-motion">
                        <h4>ğŸ“ˆ Escalabilidad</h4>
                        <p>Agrega 100 tags sin problemas</p>
                    </article>
                </div>
            </div>

            <button class="intro-cta" onclick="jumpToSection('intro-section-0-impact')" style="margin-top: var(--space-lg);">
                <span>Ver el impacto financiero</span>
                <span>â†’</span>
            </button>
        </div>
    </div>
</section>

            <!-- SECCIÃ“N 0: IMPACTO FINANCIERO -->
            <section class="chapter intro-scene-section" id="intro-section-0-impact" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>Impacto: NÃºmeros Reales</h2>
            <span class="intro-pill">Por quÃ© las empresas lo usan</span>

            <div style="margin: var(--space-xl) 0;">
                <h3>ğŸ“Š Comparativa EconÃ³mica (Anual):</h3>
                <table style="width: 100%; border-collapse: collapse; margin: var(--space-lg) 0; font-size: 0.95rem;">
                    <tr style="background: rgba(78, 205, 196, 0.1); border-bottom: 2px solid rgba(78, 205, 196, 0.3);">
                        <th style="padding: var(--space-md); text-align: left; border-right: 1px solid rgba(0,0,0,0.1);">MÃ©trica</th>
                        <th style="padding: var(--space-md); text-align: left; border-right: 1px solid rgba(0,0,0,0.1);">Sin GTM</th>
                        <th style="padding: var(--space-md); text-align: left; color: #7bc96f; font-weight: bold;">Con GTM</th>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">â±ï¸ Tiempo por evento</td>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">7-14 dÃ­as</td>
                        <td style="padding: var(--space-md); color: #7bc96f; font-weight: bold;">10-30 min</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">ğŸ“Š Eventos/mes</td>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">~3-5</td>
                        <td style="padding: var(--space-md); color: #7bc96f; font-weight: bold;">20-50+</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">ğŸ‘¨â€ğŸ’¼ Horas dev/mes</td>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">~40h</td>
                        <td style="padding: var(--space-md); color: #7bc96f; font-weight: bold;">~5h</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">ğŸ’° Coste dev (aÃ±o)</td>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">$240,000*</td>
                        <td style="padding: var(--space-md); color: #7bc96f; font-weight: bold;">$30,000</td>
                    </tr>
                    <tr>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">ğŸ’µ Ahorro</td>
                        <td style="padding: var(--space-md); border-right: 1px solid rgba(0,0,0,0.1);">â€”</td>
                        <td style="padding: var(--space-md); color: #7bc96f; font-weight: bold;">$210,000</td>
                    </tr>
                </table>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: var(--space-md);">
                    *Asumiendo dev a $125/hora (salario promedio)
                </p>
            </div>

            <div style="background: rgba(255, 206, 84, 0.1); padding: var(--space-lg); border-radius: 12px; margin: var(--space-xl) 0;">
                <h3 style="margin-top: 0;">ğŸ’¡ MÃ¡s allÃ¡ del ahorro de dev:</h3>
                <ul style="margin: var(--space-md) 0;">
                    <li><strong>Velocidad de lanzamiento:</strong> CampaÃ±a planificada lunes â†’ publicada martes</li>
                    <li><strong>Testing en tiempo real:</strong> Cambias algo, lo ves en 5 segundos (Preview)</li>
                    <li><strong>Mejor data:</strong> MÃ¡s eventos = mÃ¡s insights = mejores decisiones</li>
                    <li><strong>Scalabilidad:</strong> De 1 campaÃ±a a 100+ sin aumentar costos</li>
                </ul>
            </div>

            <button class="intro-cta" onclick="jumpToSection('intro-welcome')" style="margin-top: var(--space-lg);">
                <span>Entiendo. Vamos a aprender</span>
                <span>â†’</span>
            </button>
        </div>
    </div>
</section>

            <!-- BLOQUE 1: Tu primer dÃ­a en la agencia -->
            <section class="chapter intro-scene-section" id="intro-welcome" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h1>La EvoluciÃ³n del Tagging</h1>
            <span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text);">â±ï¸ Bloque 1 Â· ~25 min</span>
            <p style="font-size: 1.2rem; max-width: 760px; margin: var(--space-lg) auto; text-align: center;">
                Tu primer dÃ­a en la agencia. El caos espera, pero vienes con un plan: dominar el idioma de los eventos
                para que cada campaÃ±a hable con claridad.
            </p>

            <div class="intro-grid">
                <article class="intro-card-motion">
                    <h3>ğŸ¯ Tu misiÃ³n</h3>
                    <p>Dominar GTM para lanzar, medir y optimizar sin depender de despliegues eternos.</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ“– Lo que encontrarÃ¡s</h3>
                    <p>Historias, minijuegos y retos prÃ¡cticos inspirados en casos reales que consolidan cada lecciÃ³n.</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ§° Tus recursos</h3>
                    <p>Dev notes, herramientas, slides y todo el toolkit necesario para sobrevivir en
                        <a href="https://tagmanager.google.com/" target="_blank" rel="noopener noreferrer">Google Tag Manager</a>.</p>
                </article>
            </div>

            <button class="intro-cta" onclick="startIntroMission()">
                <span>Comenzar aventura</span>
                <span>â†’</span>
            </button>
        </div>
    </div>
</section>

                <!-- RPG Dialog: El desafÃ­o del CMO -->
                <section class="chapter intro-scene-section" id="intro-rpg-dialog" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game">
        <h2>ğŸ¯ MisiÃ³n 1: El desafÃ­o del CMO</h2>
            <span class="intro-pill">DiÃ¡logo interactivo</span>
        
            <div class="intro-card-motion" style="text-align: left;">
                <p>Escucha a cada personaje y elige tu respuesta. El objetivo: demostrar que puedes lanzar campaÃ±as sin bloquear a desarrollo.</p>
            </div>

            <div class="intro-game-board" style="min-height: 260px;">
        <div id="rpg-dialog-container"></div>
            </div>
        </div>
    </div>
</section>

<!-- Parte TeÃ³rica 1: QuÃ© es GTM -->
<section class="chapter intro-scene-section" id="intro-theory-1" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h1>Â¿Por quÃ© nace GTM?</h1>
            <span class="intro-pill">La historia real</span>

            <p style="font-size: 1.2rem; max-width: 720px; margin: var(--space-lg) auto; text-align: center; color: var(--text-light);">
                <strong>2012:</strong> Google se da cuenta de que todos sufren el mismo problema. Cada marketer que quiere medir algo espera a desarrollo. Cada dev estÃ¡ harto. Los datos llegan tarde. <strong>GTM nace para romper ese cuello de botella.</strong>
            </p>

            <div class="intro-grid">
                <article class="intro-card-motion">
                    <h3>ğŸ§° QuÃ© es GTM</h3>
                    <p>Un Tag Management System: una capa donde orquestas quÃ© etiquetas se ejecutan, cuÃ¡ndo y cÃ³mo.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid var(--primary); padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>En otras palabras:</strong> Es como una "caja de controles" que marketing puede tocar sin tocar cÃ³digo.
                    </p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸš€ QuÃ© resuelve</h3>
                    <p>Centraliza scripts, da autonomÃ­a a marketing, reduce deploys riesgosos y alinea equipos.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #ff9800; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Resultado:</strong> De "esperar 1 semana" a "hacer cambios en 10 minutos".
                    </p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ¯ CuÃ¡ndo lo necesitas</h3>
                    <p>Cuando tienes mÃºltiples herramientas (GA4, Meta, LinkedIn, etc.) y necesitas cambios rÃ¡pidos sin riesgo.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #4caf50; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Realidad:</strong> En empresas con >10 tags, GTM es prÃ¡cticamente obligatorio.
                    </p>
                </article>
        </div>

            <p style="text-align: center; margin-top: var(--space-lg); font-size: 1.05rem; font-weight: 600;">
                ğŸ¯ Â¿QuÃ© duele antes de GTM?
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-card-motion" style="background: rgba(244, 67, 54, 0.08); border-left: 4px solid #f44336;">
                    <h4 style="margin-top: 0; color: #f44336;">ğŸ˜¤ Para Marketing</h4>
                    <ul style="margin: var(--space-md) 0; padding-left: 1.25rem; font-size: 0.9rem;">
                        <li>Esperar 7-14 dÃ­as por cada cambio</li>
                        <li>No poder iterar rÃ¡pido en campaÃ±as</li>
                        <li>Depender de dev para TODO</li>
                        <li>Cambios se bloquean por otros sprints</li>
                </ul>
            </div>
                <div class="intro-card-motion" style="background: rgba(76, 175, 80, 0.08); border-left: 4px solid #4caf50;">
                    <h4 style="margin-top: 0; color: #4caf50;">ğŸ˜¤ Para Desarrollo</h4>
                    <ul style="margin: var(--space-md) 0; padding-left: 1.25rem; font-size: 0.9rem;">
                        <li>La cola de requests de marketing es infinita</li>
                        <li>Insertando tags = tiempo no productivo</li>
                        <li>Riesgo: cada deploy puede romper tracking</li>
                        <li>Code review para cambios que no aÃ±aden valor</li>
                    </ul>
        </div>
                <div class="intro-card-motion" style="background: rgba(3, 169, 244, 0.08); border-left: 4px solid #03a9f4;">
                    <h4 style="margin-top: 0; color: #03a9f4;">ğŸ˜¤ Para Datos/Analytics</h4>
                    <ul style="margin: var(--space-md) 0; padding-left: 1.25rem; font-size: 0.9rem;">
                        <li>Implementaciones inconsistentes</li>
                        <li>Diferentes equipos hacen tags distinto</li>
                        <li>AuditorÃ­a = pesadilla (Â¿quiÃ©n puso esto?)</li>
                        <li>Datos de mala calidad â†’ decisiones malas</li>
                    </ul>
        </div>
        </div>

            <div class="intro-card-motion" style="margin-top: var(--space-lg); background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(255, 206, 84, 0.08));">
                <h3>ğŸ“ˆ Mini timeline: CÃ³mo GTM cambiÃ³ el juego</h3>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ“…</span>
                    <div><strong>2012:</strong> Google lanza GTM. Nadie lo entiende aÃºn.</div>
            </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ“…</span>
                    <div><strong>2013-2018:</strong> AdopciÃ³n masiva en e-commerce y medios. Marketing empieza a respirar.</div>
            </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ“…</span>
                    <div><strong>2020+:</strong> GA4, server-side y consent mode. GTM deja de ser "herramienta" y se convierte en "arquitectura esencial".</div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ¯</span>
                    <div><strong>HOY:</strong> Sin GTM, no compites. Las empresas que no lo usan pierden meses en cada cambio.</div>
            </div>
        </div>

            <button class="intro-cta" onclick="completeTheory1()">
                <span>Quiero ver los pilares</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- Parte TeÃ³rica Expandible 1 -->
<section class="theory-section" id="intro-theory-expandible-1" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game" style="padding: clamp(1.8rem, 4vw, 3rem);">
        <h3>ğŸ’¡ Profundiza en GTM</h3>
            <span class="intro-pill">Recursos extra</span>

            <div class="intro-modal">
                <article class="intro-card-motion">
                    <p>Explora analogÃ­as, casos reales y checklists para entender cuÃ¡ndo GTM resuelve problemas y cuÃ¡ndo necesitas arquitectura adicional.</p>
                </article>

                <div class="intro-modal-actions">
                    <button type="button" class="intro-cta" onclick="showTheoryModal('gtmDefinition', event); return false;">
                        <span>Ver profundizaciÃ³n</span>
                        <span>â†—</span>
        </button>
                    <button type="button" class="intro-cta" onclick="continueFromIntroTheory1()">
                        <span>Seguir historia</span>
                        <span>â†’</span>
        </button>
                </div>
            </div>
        </div>
    </div>
</section>


<section class="chapter intro-scene-section" id="intro-theory-2" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>Los tres pilares de GTM</h2>
            <span class="intro-pill">Framework</span>

            <div class="intro-grid">
                <article class="intro-card-motion">
                    <div class="feature-icon">ğŸ·ï¸</div>
                    <h3>Tags</h3>
                    <p style="font-weight: 600; color: var(--primary); margin-bottom: 0.5rem;">Mensajeros que envÃ­an tu data</p>
                    <p>Son scripts que se activan para enviar informaciÃ³n a herramientas como GA4, Meta Pixel, LinkedIn, Mixpanelâ€¦</p>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.75rem; border-left: 3px solid var(--primary); padding-left: 0.75rem;">
                        <strong>Â¿Por quÃ© importa?</strong> Sin tags, tu web no "habla" con tus herramientas. No sabes quÃ© hace el usuario, no puedes hacer remarketing, no tienes datos para optimizar.
                    </p>
                </article>
                <article class="intro-card-motion">
                    <div class="feature-icon">ğŸ¯</div>
                    <h3>Triggers</h3>
                    <p style="font-weight: 600; color: #ff9800; margin-bottom: 0.5rem;">Sensores que disparan acciones</p>
                    <p>Son reglas que deciden cuÃ¡ndo activar un tag: cuando hacen click, cuando ven un video, cuando llena un formularioâ€¦</p>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.75rem; border-left: 3px solid #ff9800; padding-left: 0.75rem;">
                        <strong>Â¿Por quÃ© importa?</strong> Si no tienes triggers precisos, envÃ­as datos incorrectos. Ejemplo: contar un click en un botÃ³n "cerrar" como una compra = mÃ©tricas arruinadas.
                    </p>
                </article>
                <article class="intro-card-motion">
                    <div class="feature-icon">ğŸ“¦</div>
                    <h3>Variables</h3>
                    <p style="font-weight: 600; color: #4caf50; margin-bottom: 0.5rem;">Context que aÃ±ade detalle</p>
                    <p>Datos auxiliares que acompaÃ±an cada disparo: quÃ© producto se comprÃ³, cuÃ¡nto cuesta, quiÃ©n es el usuarioâ€¦</p>
                    <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.75rem; border-left: 3px solid #4caf50; padding-left: 0.75rem;">
                        <strong>Â¿Por quÃ© importa?</strong> Con variables, pasas de "alguien hizo algo" a "este cliente gastÃ³ â‚¬49 en la categorÃ­a X". Eso es lo que permite optimizar y vender.
                    </p>
                </article>
        </div>

            <div class="intro-card-motion" style="margin-top: var(--space-lg); background: linear-gradient(135deg, rgba(78, 205, 196, 0.08), rgba(255, 206, 84, 0.06));">
                <h3>ğŸ¬ AnalogÃ­a: Una pelÃ­cula</h3>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ¥</span>
                    <div><strong>Triggers</strong> = El director dice "Â¡ACCIÃ“N!" (detectan momentos clave)</div>
            </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ“¹</span>
                    <div><strong>Tags</strong> = Las cÃ¡maras que graban (envÃ­an datos a tus herramientas)</div>
            </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">ğŸ“</span>
                    <div><strong>Variables</strong> = La informaciÃ³n del guiÃ³n (quiÃ©n actÃºa, quÃ© dice, cuÃ¡ndo)</div>
            </div>
        </div>

            <p style="text-align: center; margin-top: var(--space-lg); font-size: 1.1rem; font-weight: 600;">
                <strong>ğŸ¯ Caso real:</strong> Cliente compra en tu tienda
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                <div style="background: rgba(69, 181, 181, 0.1); padding: var(--space-md); border-radius: 12px;">
                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">
                        <strong>ğŸ¯ TRIGGER:</strong> "Click en botÃ³n checkout"
                    </p>
            </div>
                <div style="background: rgba(255, 152, 0, 0.1); padding: var(--space-md); border-radius: 12px;">
                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">
                        <strong>ğŸ·ï¸ TAG:</strong> EnvÃ­a "purchase" a GA4
                    </p>
        </div>
                <div style="background: rgba(76, 175, 80, 0.1); padding: var(--space-md); border-radius: 12px;">
                    <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">
                        <strong>ğŸ“¦ VARIABLES:</strong> Incluye â‚¬89, "Laptop", user_id
                    </p>
                </div>
        </div>

            <button class="intro-cta" onclick="startTowerBuilderGame()">
                <span>Montar mi torre</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- Mini-juego: Construye tu torre de control -->
<section class="chapter intro-scene-section" id="intro-tower-game" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game">
            <h2>ğŸ§  Puzzle Interactivo: Torre de control</h2>
            <span class="intro-pill">Arrastra y suelta</span>

            <div class="intro-card-motion" style="text-align: left;">
                <p><strong>Objetivo:</strong> ordenar tags, triggers y variables en la torre correcta.</p>
                <p>Arrastra cada ficha hasta su columna. Si se ilumina en verde, el circuito estÃ¡ bien diseÃ±ado.</p>
            </div>

            <div class="intro-game-board">
        <div id="tower-game-container"></div>
            </div>
        </div>
    </div>
</section>

<!-- Parte TeÃ³rica 3: GTM en el ecosistema -->
<section class="chapter intro-scene-section" id="intro-theory-3" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>GTM en el ecosistema</h2>
            <span class="intro-pill">Contexto</span>

            <div class="intro-grid-3">
                <article class="intro-card-motion">
                    <h3>ğŸŒ Web</h3>
                    <p>Donde ocurren interacciones: clicks, scrolls, formularios, compras.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><strong>Ej:</strong> botÃ³n "Descargar ebook", click en anuncio, scroll al footer</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ–¥ï¸ Servidor</h3>
                    <p>Transformas datos, aplicas consent mode, envÃ­as server-side.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><strong>Ej:</strong> validar compras reales, agregar info de CRM, respetar privacidad</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ“Š Plataformas</h3>
                    <p>Analytics, ads, heatmapsâ€¦ reciben la historia que GTM traduce.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><strong>Ej:</strong> <a href="https://analytics.google.com" target="_blank" rel="noopener noreferrer">GA4</a>, <a href="https://business.facebook.com" target="_blank" rel="noopener noreferrer">Meta</a>, <a href="https://www.linkedin.com/campaignmanager" target="_blank" rel="noopener noreferrer">LinkedIn</a>, <a href="https://www.hotjar.com" target="_blank" rel="noopener noreferrer">Hotjar</a>, <a href="https://amplitude.com" target="_blank" rel="noopener noreferrer">Amplitude</a></p>
                </article>
        </div>

            <p style="margin-top: var(--space-lg); font-size: 1.05rem; font-weight: 600; text-align: center;">
                ğŸ¯ Casos de uso reales: Â¿Para quÃ© usas GTM?
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-card-motion" style="background: rgba(63, 81, 181, 0.05); border-left: 4px solid #3f51b5;">
                    <h4 style="margin-top: 0; color: #3f51b5;">ğŸ’» SaaS (Software como Servicio)</h4>
                    <p style="font-size: 0.9rem;">Track trials iniciados, feature usage, plan upgrades, churn signals. Necesitas saber quÃ© hace cada usuario dentro de tu app.</p>
                </div>
                <div class="intro-card-motion" style="background: rgba(233, 30, 99, 0.05); border-left: 4px solid #e91e63;">
                    <h4 style="margin-top: 0; color: #e91e63;">ğŸ›ï¸ E-commerce</h4>
                    <p style="font-size: 0.9rem;">Trackear product views, add-to-cart, purchase, valor de orden. Esencial para remarketing y optimizaciÃ³n de conversiÃ³n.</p>
                </div>
                <div class="intro-card-motion" style="background: rgba(76, 175, 80, 0.05); border-left: 4px solid #4caf50;">
                    <h4 style="margin-top: 0; color: #4caf50;">ğŸ“ Lead Generation</h4>
                    <p style="font-size: 0.9rem;">Track form submissions, webinar signups, call bookings, demo requests. Necesitas saber quiÃ©n es un lead calificado.</p>
                </div>
                <div class="intro-card-motion" style="background: rgba(255, 152, 0, 0.05); border-left: 4px solid #ff9800;">
                    <h4 style="margin-top: 0; color: #ff9800;">ğŸ“° Media & Publishing</h4>
                    <p style="font-size: 0.9rem;">Track page views, time spent, scroll depth, paywall conversions. Necesitas saber quÃ© contenido genera engagement.</p>
                </div>
                <div class="intro-card-motion" style="background: rgba(156, 39, 176, 0.05); border-left: 4px solid #9c27b0;">
                    <h4 style="margin-top: 0; color: #9c27b0;">ğŸ¥ Healthcare</h4>
                    <p style="font-size: 0.9rem;">Track appointment bookings, resource downloads, support interactions. Con compliance HIPAA/GDPR.</p>
                </div>
                <div class="intro-card-motion" style="background: rgba(0, 150, 136, 0.05); border-left: 4px solid #009688;">
                    <h4 style="margin-top: 0; color: #009688;">ğŸ“ EducaciÃ³n Online</h4>
                    <p style="font-size: 0.9rem;">Track course enrollment, video completion, quiz scores, certification. Necesitas saber el journey del estudiante.</p>
            </div>
        </div>

            <div class="intro-card-motion" style="margin-top: var(--space-lg);">
                <h3>ğŸ”§ Modos de implementaciÃ³n</h3>
                <div class="intro-step">
                    <span class="intro-step-bullet">C</span>
                    <div><strong>Client-side:</strong> rÃ¡pido de montar, ideal para MVP. Todos lo ven (menos privacidad).</div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">S</span>
                    <div><strong>Server-side:</strong> control y performance, menos pÃ©rdida de datos por ad-blockers. MÃ¡s seguro.</div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">H</span>
                    <div><strong>HÃ­brido:</strong> combinas velocidad y control cuando el proyecto escala (lo tÃ­pico).</div>
                </div>
            </div>

            <p style="text-align: center; color: var(--text-light); margin-top: var(--space-md);">
                No te preocupes si aÃºn no dominas server-side; lo descubrirÃ¡s mÃ¡s adelante.
            </p>

            <button class="intro-cta" onclick="startFirstEventMission()">
                <span>Vamos a escuchar eventos</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 2: Escucha tu primer evento -->
<!-- Bloque teÃ³rico 2: despuÃ©s del ecosistema -->
<section class="theory-section" id="intro-theory-expandible-2" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game" style="padding: clamp(1.5rem, 4vw, 3rem);">
        <h3>ğŸ’¡ GTM en el mundo real</h3>
            <span class="intro-pill">Profundiza</span>

            <div class="intro-modal">
                <article class="intro-card-motion">
                    <p>Client-side, server-side o hÃ­bridoâ€¦ elige segÃºn tu madurez y recursos.</p>
                </article>

                <div class="intro-modal-actions">
                    <button type="button" class="intro-cta" onclick="showTheoryModal('gtmEcosystem', event); return false;">
                        <span>Ver guÃ­a completa</span>
                        <span>â†—</span>
        </button>
                    <button type="button" class="intro-cta" onclick="continueFromIntroTheory2()">
                        <span>Seguir misiÃ³n</span>
                        <span>â†’</span>
        </button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="chapter intro-scene-section" id="intro-mission-2" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game">
        <h2>ğŸ§ª MisiÃ³n 2: Escucha tu primer evento</h2>
            <span class="intro-pill">Hands-on: tu primer GTM</span>

            <p style="font-size: 1.05rem; max-width: 720px; margin: var(--space-lg) auto; text-align: center; color: var(--text-light);">
                Vamos a montarte un GTM mÃ­nimo. Tu objetivo: <strong>lanzar un evento desde la consola y verlo aparecer en tiempo real.</strong> Esto es lo que hace un marketer todos los dÃ­as.
            </p>

            <div class="intro-card-motion" style="text-align: left; background: rgba(63, 81, 181, 0.08); border-left: 4px solid #3f51b5;">
                <h3>ğŸ¯ QuÃ© vas a conseguir</h3>
                <ul style="margin: 0; padding-left: 1.25rem;">
                    <li><strong>Entender el ciclo:</strong> Pushear dato â†’ GTM lo escucha â†’ aparece en Debug</li>
                    <li><strong>Perder el miedo:</strong> No es magia, es lÃ³gica simple</li>
                    <li><strong>Ver la magia de GTM:</strong> CÃ³digo que se ejecuta SIN tocar desarrollo</li>
                </ul>
            </div>

            <div class="intro-card-motion" style="text-align: left;">
                <h3>ğŸªœ Los pasos (son solo 5)</h3>
                <div class="intro-step">
                    <span class="intro-step-bullet">1ï¸âƒ£</span>
                    <div>
                        <strong><a href="https://support.google.com/tagmanager/answer/6103696" target="_blank" rel="noopener noreferrer">Crea el contenedor GTM</a></strong>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">En GTM, un "contenedor" es como tu "espacio de trabajo". AquÃ­ vivirÃ¡n todos tus tags, triggers y variables. Necesita estar atado a tu dominio.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">2ï¸âƒ£</span>
                    <div>
                        <strong><a href="https://support.google.com/tagmanager/answer/6107124" target="_blank" rel="noopener noreferrer">InstÃ¡lalo en tu web de prueba</a></strong>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">GTM te da un script. Copias ese script en tu web. Eso es TODO lo que tocarÃ¡s de cÃ³digo (esto es lo que hace especial a GTM).</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">3ï¸âƒ£</span>
                    <div>
                        <strong><a href="https://support.google.com/tagmanager/answer/7056056" target="_blank" rel="noopener noreferrer">Abre Preview Mode</a></strong>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">El "Preview Mode" es como un espejo. Ves exactamente quÃ© eventos se disparan y quÃ© hace GTM con ellos ANTES de publicar cambios a todos los usuarios.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">4ï¸âƒ£</span>
                    <div>
                        <strong>Pushea tu primer evento desde la consola</strong>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">Abre la consola del navegador (F12) y ejecuta esto:</p>
                        <pre style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); color: #4fda7f; padding: 1rem; border-radius: 8px; margin-top: var(--space-sm); border-left: 3px solid #4fda7f; font-family: 'Courier New', monospace; overflow-x: auto;">dataLayer.push(&#123; event: 'hello_gtm', user: 'yo' &#125;)</pre>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;">ğŸ’¡ Lo que hiciste: pushear un "paquete de datos" al dataLayer. GTM estÃ¡ escuchando siempre.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet">5ï¸âƒ£</span>
                    <div>
                        <strong>Confirma en el Preview Debugger</strong>
                        <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">Mira el panel de Preview. Debe mostrar:</p>
                        <pre style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); color: #fff; padding: 1rem; border-radius: 8px; margin-top: var(--space-sm); border-left: 3px solid #ffc107; font-family: 'Courier New', monospace; overflow-x: auto;">Event: hello_gtm
Page URL: [tu pÃ¡gina]
user: yo
Tags fired: [ninguno aÃºn, porque no hay trigger para este evento]</pre>
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;">âœ… Â¡Lo ves! GTM capturÃ³ tu evento. Ahora mismo no hace nada con Ã©l, pero estÃ¡ atrapado. Es el primer paso.</p>
                    </div>
            </div>
        </div>

            <div class="intro-card-motion" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.08)); border-left: 4px solid #ffc107;">
                <h3>ğŸ’¡ Â¿Por quÃ© importa este paso?</h3>
                <p style="margin: var(--space-md) 0;">
                    La mayorÃ­a de marketers aprenden GTM construyendo tags sin entender QUÃ‰ son los eventos. <strong>Esto es al revÃ©s.</strong> Un evento es el DNA de GTM. Todo parte de aquÃ­. Una vez que entiendes esto, todo lo demÃ¡s es "conecta los puntos".
                </p>
                <p style="margin: 0; font-size: 0.9rem; color: var(--text-light);">
                    âœ¨ <strong>Bonus:</strong> Si logras esto, acabas de hacer lo que hace un dev todos los dÃ­as: "enviar datos al tracking". Pero lo hiciste desde la consola en 2 minutos. Sin tickets. Sin sprints. Sin deploy. <strong>Eso es GTM.</strong>
                </p>
            </div>

            <button class="intro-cta" onclick="completeFirstEvent()">
                <span>âœ… Evento completado</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- Parte TeÃ³rica 4: Beneficios estratÃ©gicos -->
<section class="theory-section" id="intro-theory-4" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>Dominar GTM = Superpoder ğŸ¦¸</h2>
            <span class="intro-pill">Beneficios reales</span>

            <p style="font-size: 1.05rem; max-width: 720px; margin: var(--space-lg) auto; text-align: center; color: var(--text-light);">
                GTM no es "una herramienta de marketing". Es una **herramienta de autonomÃ­a**. Un marketer que domina GTM no espera nada. Lanza, mide y optimiza. Ahora.
            </p>

            <div class="intro-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
                <article class="intro-card-motion">
                    <h3>âš¡ Velocidad</h3>
                    <p>Lanza experimentos sin depender del ciclo de release.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #ffc107; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Realidad:</strong> De "esperar 2 sprints" a "publicar en 10 minutos"
                    </p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ¯ PrecisiÃ³n</h3>
                    <p>Controlas quÃ© datos salen y cÃ³mo, evitando ruido analÃ­tico.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #ff9800; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Realidad:</strong> "Rastreo puro" sin clicks accidentales
                    </p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ§ª Flexibilidad</h3>
                    <p>Testea hipÃ³tesis con seguridad; puedes revertir en segundos.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #4caf50; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Realidad:</strong> "Experimenta sin miedo" = crecimiento mÃ¡s rÃ¡pido
                    </p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ¤ CoordinaciÃ³n</h3>
                    <p>Marketing, producto y data hablan el mismo idioma.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); border-top: 2px solid #673ab7; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <strong>Realidad:</strong> Sin intermediarios, sin "esperar respuesta del dev"
                    </p>
                </article>
        </div>

            <p style="text-align: center; margin-top: var(--space-lg); font-size: 1.05rem; font-weight: 600;">
                ğŸ¯ Casos reales: Lo que hacen marketers con GTM
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-card-motion" style="background: rgba(233, 30, 99, 0.08); border-left: 4px solid #e91e63;">
                    <h4 style="margin-top: 0; color: #e91e63;">ğŸ’» Startup SaaS</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track trial signups, feature adoption, plan upgrades en tiempo real.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Identifica churn signals al dÃ­a 1, no al mes 3. Ahorra cientos de miles en LTV.
                    </p>
            </div>
                <div class="intro-card-motion" style="background: rgba(233, 30, 99, 0.08); border-left: 4px solid #e91e63;">
                    <h4 style="margin-top: 0; color: #e91e63;">ğŸ›ï¸ E-commerce</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track product views, add-to-cart, compras, abandonos de carrito.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Remarketing hiperpreciso. Lunes ve alguien mirar zapatos â†’ jueves le llega anuncio exacto. +40% conversiÃ³n.
                    </p>
            </div>
                <div class="intro-card-motion" style="background: rgba(33, 150, 243, 0.08); border-left: 4px solid #2196f3;">
                    <h4 style="margin-top: 0; color: #2196f3;">ğŸ“Š Media</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track artÃ­culos leÃ­dos, scroll depth, video completion, suscripciones.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Sabe quÃ© contenido genera engagement. Ajusta editorial en tiempo real (hoy, no en 2 meses).
                    </p>
            </div>
                <div class="intro-card-motion" style="background: rgba(76, 175, 80, 0.08); border-left: 4px solid #4caf50;">
                    <h4 style="margin-top: 0; color: #4caf50;">ğŸ“ Lead Gen / B2B</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track form submissions, qualification score, lead source, follow-up time.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Sales sabe 5 min despuÃ©s que hay un lead. Contesta de inmediato = +60% conversion.
                    </p>
            </div>
                <div class="intro-card-motion" style="background: rgba(255, 152, 0, 0.08); border-left: 4px solid #ff9800;">
                    <h4 style="margin-top: 0; color: #ff9800;">ğŸ Marketplace</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track searches, favorites, listings viewed, transactions, reviews.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Entiende patrones de compra. "Viernes 20:00 los millennials buscan X" â†’ lanza stock inteligente.
                    </p>
        </div>
                <div class="intro-card-motion" style="background: rgba(156, 39, 176, 0.08); border-left: 4px solid #9c27b0;">
                    <h4 style="margin-top: 0; color: #9c27b0;">ğŸ® Juegos / Apps</h4>
                    <p style="font-size: 0.9rem;">
                        <strong>Â¿QuÃ© hace?</strong> Track level completion, IAP, retention, DAU/MAU, session duration.
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-light);">
                        <strong>Beneficio:</strong> Sabe dÃ³nde abandonan usuarios. Ajusta difficulty/rewards â†’ +35% retention.
                    </p>
            </div>
        </div>

            <div class="intro-card-motion" style="margin-top: var(--space-lg); background: linear-gradient(135deg, rgba(63, 81, 181, 0.1), rgba(76, 175, 80, 0.08)); border-left: 4px solid #3f51b5;">
                <h3>âœ¨ La verdad sobre GTM</h3>
                <p style="margin: var(--space-md) 0;">
                    <strong>Quien controla GTM no es un "marketer que usa herramientas".</strong> Es alguien que ENTIENDE el data flow completo. Sabe quÃ© pregunta hace, dÃ³nde trackear la respuesta, y cÃ³mo transmitirla a quien la necesita.
                </p>
                <p style="margin: var(--space-md) 0;">
                    Eso es autonomÃ­a. Eso es poder. Y eso es lo que te estamos enseÃ±ando aquÃ­.
                </p>
            </div>

            <button class="intro-cta" onclick="startMarketerQuiz()">
                <span>Prueba del marketer</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- Mini-juego: La prueba del marketer -->
<!-- Bloque teÃ³rico 3: despuÃ©s de beneficios -->
<section class="theory-section" id="intro-theory-expandible-3" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game" style="padding: clamp(1.5rem, 4vw, 3rem);">
        <h3>ğŸ’¡ El poder estratÃ©gico de GTM</h3>
            <span class="intro-pill">Profundiza</span>

            <div class="intro-modal">
                <article class="intro-card-motion">
                    <p>Tu torre ya escucha. Ahora necesitas procesos para que cada dato se convierta en decisiÃ³n.</p>
                </article>

                <div class="intro-modal-actions">
                    <button type="button" class="intro-cta" onclick="showTheoryModal('gtmBenefits', event); return false;">
                        <span>Ver casos reales</span>
                        <span>â†—</span>
        </button>
                    <button type="button" class="intro-cta" onclick="continueFromIntroTheory3()">
                        <span>Volver al juego</span>
                        <span>â†’</span>
        </button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="chapter intro-scene-section" id="intro-quiz-game" style="display: none;">
    <div class="center-content">
        <div class="intro-hero intro-hero--game">
            <h2>ğŸ“‹ Prueba del marketer</h2>
            <span class="intro-pill">Quiz interactivo</span>

            <div class="intro-card-motion" style="text-align: left;">
                <p>Responde a las preguntas y demuestra que dominas la torre de control. Cada acierto suma XP.</p>
            </div>

            <div class="intro-game-board">
        <div id="marketer-quiz-container"></div>
            </div>
        </div>
    </div>
</section>

<!-- Cierre del Bloque 1 -->
<section class="chapter intro-scene-section" id="intro-final" style="display: none;">
    <div class="center-content">
        <div class="intro-hero">
            <h2>ğŸ Has desbloqueado la torre de control</h2>
            <span class="intro-pill">Resumen</span>

            <div class="intro-grid-3">
                <article class="intro-card-motion">
                    <h3>âœ… Comprendiste</h3>
                    <p>QuÃ© es GTM, por quÃ© nace y cÃ³mo centraliza la gestiÃ³n de etiquetas.</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ§± Construiste</h3>
                    <p>Una torre con tags, triggers y variables ordenadas y documentadas.</p>
                </article>
                <article class="intro-card-motion">
                    <h3>ğŸ§ª Practicaste</h3>
                    <p>Escuchar eventos reales y validar implementaciones desde el debugger.</p>
                </article>
        </div>

            <div class="intro-card-motion" style="text-align: center; margin-top: var(--space-lg);">
                <p><strong>Ya no eres un marketer que espera deploys: eres quien controla la torre.</strong></p>
        </div>

            <button class="intro-cta" onclick="startBloque2()">
                <span>Siguiente misiÃ³n: El lenguaje secreto</span>
                <span>â†’</span>
        </button>
        </div>
    </div>
</section>

<!-- Nueva secciÃ³n: Los secretos que nadie te cuenta -->
<section class="chapter intro-scene-section" id="intro-secretos" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 2.5rem; text-align: center; margin-bottom: 2rem;">ğŸ¤« Los secretos que nadie te cuenta al empezar</h1>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p>Antes de que pongas una sola etiqueta...</p>
                <p>hay algunas cosas que la mayorÃ­a aprende a base de golpes.</p>
            </div>
        </div>

        <div id="secretos-container" style="margin-top: 3rem;">
            <div class="minigame-container">
                <h3 class="minigame-title">ğŸ´ Descubre los secretos</h3>
                <p class="minigame-instructions">Haz clic en cada carta para revelar un secreto que te ahorrarÃ¡ horas de frustraciÃ³n.</p>
                
                <div id="secretos-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                    <!-- Las cartas se generarÃ¡n dinÃ¡micamente -->
                </div>
                
                <div id="secretos-result" style="display: none; margin-top: 3rem;"></div>
            </div>
        </div>
    </div>
</section>


<!-- BLOQUE 2: El lenguaje secreto de los eventos -->

<!-- Escena de Bienvenida al Bloque 2 -->
<section class="chapter intro-scene-section" id="bloque2-welcome" style="display: none;">
                <div class="narrator-box" style="margin-bottom: 2rem;">
                    <div class="narrator-icon">ğŸ§ </div>
                    <div class="narrator-text">
                        <p><strong>Has construido la torre. Ahora toca darle voz.</strong></p>
                        <p>En este bloque descubrirÃ¡s el idioma secreto de los eventos: cÃ³mo nombrarlos, estructurarlos y hacer que cada uno cuente una historia clara.</p>
                        <p>SerÃ¡s capaz de convertir clics dispersos en seÃ±ales ordenadas que cualquier herramienta puede entender.</p>
            </div>
        </div>

    <div class="narrative center-content">
        <h1 style="font-size: 3rem; margin-bottom: 1rem;">ğŸ§  El lenguaje secreto de los eventos</h1>
        <span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text); margin-bottom: 1rem; display: inline-block;">â±ï¸ Bloque 2 Â· ~30 min</span>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p>Tu torre estÃ¡ en pie. Pero una torre sin idioma es un castillo mudo.</p>
                <p>Cada clic, cada scroll, cada conversiÃ³n habla un idioma: <strong>el idioma de los eventos.</strong></p>
                <p><strong>Tu misiÃ³n:</strong> aprender a escucharlo, interpretarlo y hablarlo de vuelta.</p>
            </div>
        </div>

        <p style="text-align: center; margin: var(--space-lg) 0; font-size: 1.05rem; max-width: 720px; margin-left: auto; margin-right: auto; color: var(--text-light);">
            <strong>Â¿Por quÃ© esto importa?</strong> Porque la diferencia entre un GTM que funciona y uno que falla estÃ¡ en cÃ³mo defines tus eventos. Un evento mal nombrado = datos inÃºtiles. Un evento bien estructurado = decisiones que valen millones.
        </p>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ‘¨â€ğŸ’»</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>"Los eventos no son magia. Son mensajes en un idioma estructurado.</p>
                <p>Aprende a leerlos... y controlarÃ¡s el caos."</p>
                <p style="margin-bottom: 0; font-size: 0.9rem; color: var(--text-light); margin-top: 0.75rem;">
                    <strong>O dicho de otro modo:</strong> Un e-commerce sin eventos bien nombrados no sabe si sus clientes abandonan por precio o por UX. Una SaaS sin eventos de feature usage no sabe cuÃ¡l feature de â‚¬500k/aÃ±o realmente usan. Eso es dinero tirado.
                </p>
            </div>
        </div>

        <button class="btn-continue" onclick="startBloque2Intro()">
            Comenzar misiÃ³n â†’
        </button>
    </div>
</section>

<!-- IntroducciÃ³n al dataLayer (puente conceptual) -->
<section class="chapter intro-scene-section" id="bloque2-intro-datalayer" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ“¦ Â¿QuÃ© es el dataLayer?</h2>
        <span class="intro-pill">Minijuego: La Cocina del Dato</span>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ³</div>
            <div class="narrator-text">
                <p><strong>Bienvenido a la cocina de tu web.</strong></p>
                <p>GTM es el Chef. Ã‰l cocina los Tags.</p>
                <p>Pero un Chef no puede cocinar si la despensa estÃ¡ vacÃ­a.</p>
                <p><strong>El dataLayer es tu despensa.</strong></p>
            </div>
        </div>

        <div class="intro-card-motion" style="margin: 2rem 0;">
            <p><strong>MisiÃ³n:</strong> El Chef GTM necesita cocinar platos especÃ­ficos (Tags). Arrastra los ingredientes correctos (Variables) desde el dataLayer a la olla.</p>
        </div>

        <div id="pantry-game-container" style="min-height: 400px; padding: 1rem;">
            <button class="btn-primary" onclick="PANTRY_GAME.init('pantry-game-container')">
                ğŸ¥— Entrar a la Cocina
            </button>
        </div>
        
        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“</div>
            <div class="narrator-text">
                <p><strong>LecciÃ³n:</strong> Sin dataLayer, GTM se muere de hambre.</p>
            </div>
        </div>

        <button class="btn-continue" onclick="startBloque2Mission1()" style="margin-top: 2rem;">
            Continuar: AnatomÃ­a de un evento â†’
        </button>
    </div>
</section>

<section class="chapter intro-scene-section" id="bloque2-theory-1" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ“Š AnatomÃ­a de un evento en GTM</h2>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>Cada vez que ocurre algo en la web</strong> â€”un clic, un scroll, una compraâ€”, ese suceso puede convertirse en un evento GTM.</p>
            </div>
        </div>

        <div style="background: #000; color: #0f0; padding: var(--space-xl); border-radius: 10px; margin: 2rem 0; font-family: 'Courier New', monospace;">
            <p style="color: #888; margin-bottom: 1rem;">// Estructura base de un evento en el dataLayer:</p>
            <pre style="margin: 0; color: #0f0;">dataLayer.push(&#123;
  event: 'nombre_del_evento',
  key1: 'valor1',
  key2: 'valor2'
&#125;)</pre>
        </div>

        <div class="gtm-features">
            <div class="feature">
                <div class="feature-icon">ğŸ¯</div>
                <h4>event</h4>
                <p>El identificador que GTM escucha. Ej: 'add_to_cart', 'video_play', 'form_submit'</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ”‘</div>
                <h4>keys (variables)</h4>
                <p>Pares clave-valor con informaciÃ³n. Ej: product_id, price, user_segment</p>
            </div>
            <div class="feature">
                <div class="feature-icon">âš¡</div>
                <h4>Flujo</h4>
                <p>GTM escucha â†’ evalÃºa triggers â†’ ejecuta tags â†’ envÃ­a datos a herramientas</p>
            </div>
        </div>

        <div class="narrator-box analogy">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Cada push al dataLayer es como una frase en cÃ³digo.</strong></p>
                <p>Si GTM entiende la palabra clave (event), reacciona y ejecuta tags.</p>
                <p>Si la estructura es confusa o inconsistente... obtienes datos basura.</p>
            </div>
        </div>

        <p style="text-align: center; margin: var(--space-lg) 0; font-size: 1.05rem; font-weight: 600;">
            ğŸ¯ Casos reales: Lo que se pierde por eventos mal nombrados
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin: var(--space-lg) 0;">
            <div style="background: rgba(244, 67, 54, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #f44336;">
                <h4 style="margin-top: 0; color: #f44336;">âŒ E-commerce sin eventos claros</h4>
                <p style="font-size: 0.9rem;">
                    <strong>Problema:</strong> Todos los clicks van a un evento genÃ©rico "click". No diferencian entre clics en descuento, en producto, en carrito.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Consecuencia:</strong> "Â¿Por quÃ© desciende conversiÃ³n?" â†’ no lo sabes. Marketing no puede optimizar. Pierden 30% de posible revenue.
                </p>
            </div>
            <div style="background: rgba(33, 150, 243, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #2196f3;">
                <h4 style="margin-top: 0; color: #2196f3;">âŒ SaaS sin feature tracking</h4>
                <p style="font-size: 0.9rem;">
                    <strong>Problema:</strong> No trackean quÃ© features usan los clientes. Solo ven: "X usuarios activos".
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Consecuencia:</strong> Gastan â‚¬500k/aÃ±o en feature A que nadie usa. Cancelan porque no ven ROI. Pudo haberse salvado con eventos.
                </p>
            </div>
            <div style="background: rgba(76, 175, 80, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #4caf50;">
                <h4 style="margin-top: 0; color: #4caf50;">âœ… E-commerce con eventos precisos</h4>
                <p style="font-size: 0.9rem;">
                    <strong>Estructura:</strong> Eventos especÃ­ficos: 'product_view', 'add_to_cart', 'checkout_started', 'purchase'. Cada uno con variables: product_id, price, category.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Resultado:</strong> Ven el funnel completo. Descubren que abandonan en "checkout_started" (problema UX). Lo arreglan. +25% conversiÃ³n. â‚¬2M de revenue extra.
                </p>
            </div>
        </div>

        <div style="background: rgba(255, 193, 7, 0.1); border: 2px solid #ffc107; padding: var(--space-lg); border-radius: 10px; margin: 2rem 0;">
            <h4 style="color: #ff9800; margin-top: 0;">âš ï¸ Ejemplo prÃ¡ctico: El poder de la claridad</h4>
            <p><strong>Evento MAL nombrado:</strong> <code>click</code> â†’ "alguien hizo algo"</p>
            <p><strong>Evento BIEN nombrado:</strong> <code>add_to_cart</code> con variables <code>product_id: 42, price: 89.99, category: "electronics"</code> â†’ "un cliente de electrÃ³nica aÃ±adiÃ³ un producto de â‚¬89.99"</p>
            <p style="margin-bottom: 0;"><strong>ğŸ’¡ La diferencia?</strong> El segundo permite tomar decisiones. Remarketing a gente que abandona electrÃ³nica. AnÃ¡lisis de abandono por categorÃ­a. Revenue forecasting preciso.</p>
        </div>

        <button class="btn-continue" onclick="startBloque2Game1()">
            MisiÃ³n 1: Traduce el mensaje secreto â†’
        </button>
    </div>
</section>

<!-- Mini-juego 1: Traduce el mensaje secreto -->
<section class="chapter intro-scene-section" id="bloque2-game-1" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ§ª MisiÃ³n 1: traduce el mensaje secreto</h2>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <p>Se muestra un dataLayer.push incompleto.</p>
                <p><strong>Tu objetivo:</strong> arrastra las piezas correctas para formar un evento vÃ¡lido que GTM pueda entender.</p>
            </div>
        </div>
        
        <div id="bloque2-game-1-container"></div>
    </div>
</section>

<!-- Parte TeÃ³rica 2: Tipos de Triggers -->
<section class="chapter intro-scene-section" id="bloque2-theory-2" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ¯ Tipos de triggers (lÃ³gica avanzada)</h2>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>Un trigger es la condiciÃ³n lÃ³gica</strong> que hace que una etiqueta se dispare.</p>
                <p>No basta con escuchar el evento: hay que saber <strong>cuÃ¡ndo y bajo quÃ© condiciones.</strong></p>
            </div>
        </div>

        <div class="benefits-list" style="margin: 2rem 0;">
            <div class="benefit-item">
                <span class="benefit-icon">ğŸŸ¢</span>
                <span><strong>Custom Event Trigger:</strong> escucha dataLayer.push</span>
            </div>
            <div class="benefit-item">
                <span class="benefit-icon">ğŸŸ¡</span>
                <span><strong>Click Trigger:</strong> escucha interacciÃ³n directa en elementos</span>
            </div>
            <div class="benefit-item">
                <span class="benefit-icon">ğŸ”µ</span>
                <span><strong>Pageview Trigger:</strong> escucha cargas de pÃ¡gina</span>
            </div>
            <div class="benefit-item">
                <span class="benefit-icon">ğŸŸ </span>
                <span><strong>Otros:</strong> Form Submission, Timer, History Change...</span>
            </div>
        </div>

        <div class="narrator-box analogy">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Un trigger es como un traductor:</strong></p>
                <p>"Si escuchas 'add_to_cart' con las condiciones correctas... dispara la etiqueta."</p>
            </div>
        </div>

        <div style="background: rgba(78, 205, 196, 0.1); padding: var(--space-xl); border-radius: 10px; margin: 2rem 0;">
            <h4>ğŸ“Œ Ejemplo de condicional:</h4>
            <ul style="list-style: none; padding-left: 0;">
                <li>âœ… <strong>Evento:</strong> add_to_cart</li>
                <li>âœ… <strong>CondiciÃ³n:</strong> price > 0</li>
                <li>âœ… <strong>AcciÃ³n:</strong> disparar GA4 event</li>
            </ul>
        </div>

        <div style="margin: 2rem 0;">
            <h3 style="text-align: center; margin-bottom: 1rem;">ğŸ§  Conceptos clave:</h3>
            <div class="benefits-list">
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ”</span>
                    <span>Filtros lÃ³gicos</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">âš–ï¸</span>
                    <span>Operadores (equals, contains, matches regex)</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ”¢</span>
                    <span>EvaluaciÃ³n secuencial de triggers</span>
                </div>
            </div>
        </div>

        <button class="btn-continue" onclick="startBloque2Game2()">
            Puzzle: Construye un trigger correcto â†’
        </button>
    </div>
</section>

<!-- Mini-juego 2: Construye un trigger -->

<!-- Bloque TeÃ³rico Expandible 1 -->
<section class="theory-section" id="bloque2-theory-expandible-1" style="display: none;">
    <div class="center-content">
        <h3>ğŸ’¡ Fundamentos de GTM</h3>
        <p>Antes de continuar, vamos a entender los 3 pilares fundamentales de Google Tag Manager.</p>
        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('afterBloque2Part1', event); return false;">
            ğŸ“š Ver conceptos: tags, triggers y variables
        </button>
        <button class="btn-continue" style="margin-top: 2rem;" onclick="continueFromTheoryBlock1()">
            Continuar â†’
        </button>
    </div>
</section>

<section class="chapter intro-scene-section" id="bloque2-game-2" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ§  Puzzle: Construye un Trigger Correcto</h2>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <p><strong>Tu objetivo:</strong></p>
                <ol style="padding-left: 1.5rem;">
                    <li>Elegir el tipo correcto de trigger</li>
                    <li>Definir la condiciÃ³n lÃ³gica correcta</li>
                    <li>Asociarlo a un evento</li>
                </ol>
            </div>
        </div>
        
        <div id="bloque2-game-2-container"></div>
    </div>
</section>

<!-- Parte TeÃ³rica 3: Variables -->
<section class="chapter intro-scene-section" id="bloque2-theory-3" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ“¦ Variables (profundidad estratÃ©gica)</h2>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>Las variables son la memoria de GTM.</strong></p>
                <p>Es donde guarda informaciÃ³n temporal que luego se usa en etiquetas o triggers.</p>
            </div>
        </div>

        <div class="gtm-features">
            <div class="feature">
                <div class="feature-icon">ğŸ”§</div>
                <h4>Built-in</h4>
                <p>Click URL, Page URL, Referrer...</p>
            </div>
            <div class="feature">
                <div class="feature-icon">ğŸ“Š</div>
                <h4>Data Layer</h4>
                <p>Variables extraÃ­das del dataLayer</p>
            </div>
            <div class="feature">
                <div class="feature-icon">âš™ï¸</div>
                <h4>Personalizadas</h4>
                <p>JavaScript, Lookup Tables, Regex...</p>
            </div>
        </div>

        <div class="narrator-box analogy">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Sin variables, las etiquetas no tienen contexto.</strong></p>
                <p>Es como lanzar una flecha sin saber dÃ³nde estÃ¡s.</p>
            </div>
        </div>

        <div style="background: #000; color: #0f0; padding: var(--space-xl); border-radius: 10px; margin: 2rem 0; font-family: 'Courier New', monospace;">
            <p style="color: #888; margin-bottom: 1rem;">// Ejemplo:</p>
            <pre style="margin: 0; color: #0f0;">dataLayer.push(&#123;
  event: 'purchase',
  transaction_id: '12345',
  revenue: 100
&#125;)

// Variable transaction_id extraÃ­da â†’ GA4 event
// Variable revenue â†’ envÃ­o a Ads</pre>
        </div>

        <button class="btn-continue" onclick="startBloque2Game3()">
            MisiÃ³n 2: Atrapa el valor correcto â†’
        </button>
    </div>
</section>

<!-- Mini-juego 3: Atrapa el valor correcto -->

<!-- Bloque TeÃ³rico Expandible 2 -->
<section class="theory-section" id="bloque2-theory-expandible-2" style="display: none;">
    <div class="center-content">
        <h3>ğŸ’¡ Profundiza en el Data Layer</h3>
        <p>Ahora que entiendes la anatomÃ­a de los eventos, aprende mÃ¡s sobre el Data Layer.</p>
        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('dataLayer', event); return false;">
            ğŸ“š Ver Conceptos Avanzados del Data Layer
        </button>
        <button class="btn-continue" style="margin-top: 2rem;" onclick="continueFromTheoryBlock2()">
            Continuar â†’
        </button>
    </div>
</section>

<section class="chapter intro-scene-section" id="bloque2-game-3" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ§ª MisiÃ³n 2: atrapa el valor correcto</h2>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <p>Se muestra un dataLayer con varios valores mezclados.</p>
                <p><strong>Tu objetivo:</strong> selecciona quÃ© variable necesitas extraer y declÃ¡rala correctamente.</p>
            </div>
        </div>
        
        <div id="bloque2-game-3-container"></div>
    </div>
</section>

<!-- Parte TeÃ³rica 4: Tags -->
<section class="chapter intro-scene-section" id="bloque2-theory-4" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ·ï¸ Tags (acciÃ³n y responsabilidad)</h2>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>Una Tag es la acciÃ³n final</strong> que ejecuta GTM cuando un trigger se cumple.</p>
            </div>
        </div>

        <div class="benefits-list" style="margin: 2rem 0;">
            <div class="benefit-item">
                <span class="benefit-icon">ğŸ“¤</span>
                <span>Enviar datos a plataformas (GA4, Meta, TikTok...)</span>
            </div>
            <div class="benefit-item">
                <span class="benefit-icon">ğŸ’»</span>
                <span>Ejecutar cÃ³digo custom</span>
            </div>
            <div class="benefit-item">
                <span class="benefit-icon">ğŸ“œ</span>
                <span>Cargar scripts de terceros</span>
            </div>
        </div>

        <div class="narrator-box analogy">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Si triggers son los oÃ­dos, y variables la memoria...</strong></p>
                <p>Las tags son la voz.</p>
            </div>
        </div>

        <div style="background: rgba(78, 205, 196, 0.1); padding: var(--space-xl); border-radius: 10px; margin: 2rem 0;">
            <h4>ğŸ“Œ Ejemplo: GA4 Event Tag</h4>
            <ul style="list-style: none; padding-left: 0;">
                <li>âœ… <strong>Trigger:</strong> Custom Event "purchase"</li>
                <li>âœ… <strong>Variables:</strong> transaction_id, value</li>
                <li>âœ… <strong>AcciÃ³n:</strong> enviar evento purchase a GA4</li>
            </ul>
        </div>

        <div style="margin: 2rem 0;">
            <h3 style="text-align: center; margin-bottom: 1rem;">âš ï¸ Conceptos importantes:</h3>
            <div class="benefits-list">
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ”¢</span>
                    <span>Orden de evaluaciÃ³n (variables â†’ triggers â†’ tags)</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">â­ï¸</span>
                    <span>Sequencing (orden de disparo)</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">âœ…</span>
                    <span>Importancia de QA</span>
                </div>
            </div>
        </div>

        <button class="btn-continue" onclick="startBloque2Game4()">
            MisiÃ³n 3: Lanza tu primer hechizo â†’
        </button>
    </div>
</section>

<!-- Mini-juego 4: Lanza tu primer hechizo (continuarÃ¡ en el siguiente mensaje por lÃ­mite de caracteres) -->


<!-- Mini-juego 4: Lanza tu primer hechizo -->

<!-- Bloque TeÃ³rico Expandible 3 -->
<section class="theory-section" id="bloque2-theory-expandible-3" style="display: none;">
    <div class="center-content">
        <h3>ğŸ’¡ Aprende mÃ¡s sobre Variables</h3>
        <p>Las variables son la memoria de GTM. Profundiza en su uso y configuraciÃ³n.</p>
        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('variables', event); return false;">
            ğŸ“š Ver GuÃ­a Completa de Variables
        </button>
        <button class="btn-continue" style="margin-top: 2rem;" onclick="continueFromTheoryBlock3()">
            Continuar â†’
        </button>
    </div>
</section>

<section class="chapter intro-scene-section" id="bloque2-game-4" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ§ª MisiÃ³n 3: lanza tu primer hechizo</h2>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <p><strong>ConfiguraciÃ³n completa de Tag:</strong></p>
                <ol style="padding-left: 1.5rem;">
                    <li>Configurar un trigger correcto</li>
                    <li>Capturar la variable adecuada</li>
                    <li>Asignarla a una etiqueta GA4</li>
                    <li>Probarlo en Preview Mode (simulado)</li>
                </ol>
            </div>
        </div>
        
        <div id="bloque2-game-4-container"></div>
    </div>
</section>

<!-- Parte TeÃ³rica 5: Debugging y QA -->
<section class="chapter intro-scene-section" id="bloque2-theory-5" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ” Debugging y QA (profundidad operativa)</h2>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>No basta con configurar. Hay que verificar.</strong></p>
                <p>GTM ofrece un entorno de debugging excelente.</p>
            </div>
        </div>

        <div style="background: rgba(78, 205, 196, 0.1); padding: var(--space-xl); border-radius: 10px; margin: 2rem 0;">
            <h3>ğŸ“Œ QuÃ© mirar en el Debugger:</h3>
            <div class="benefits-list" style="margin-top: 1rem;">
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ‘‚</span>
                    <span>Evento escuchado</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ¯</span>
                    <span>Triggers activados</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ“¦</span>
                    <span>Variables leÃ­das</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ·ï¸</span>
                    <span>Etiquetas ejecutadas</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ”¢</span>
                    <span>Orden de disparo</span>
                </div>
            </div>
        </div>

        <div class="narrator-box analogy">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>El Debugger es como un radar:</strong></p>
                <p>Te dice si tus naves despegaron, si se estrellaron o si nunca salieron del hangar.</p>
            </div>
        </div>

        <div style="margin: 2rem 0;">
            <h3 style="text-align: center; margin-bottom: 1rem;">ğŸ§  Errores comunes a detectar:</h3>
            <div class="benefits-list">
                <div class="benefit-item">
                    <span class="benefit-icon">âŒ</span>
                    <span><strong>Typos:</strong> Nombres mal escritos</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸš«</span>
                    <span><strong>Triggers mal definidos:</strong> Condiciones incorrectas</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">âš ï¸</span>
                    <span><strong>Eventos mal nombrados:</strong> Inconsistencia</span>
                </div>
                <div class="benefit-item">
                    <span class="benefit-icon">ğŸ”§</span>
                    <span><strong>Variables undefined:</strong> No capturadas correctamente</span>
                </div>
            </div>
        </div>

        <div style="background: rgba(255, 193, 7, 0.1); border: 2px solid #ffc107; padding: var(--space-lg); border-radius: 10px; margin: 2rem 0;">
            <h4 style="color: #ff9800; margin-top: 0;">ğŸ’¡ Pro tip:</h4>
            <p>Debugging con <strong><a href="https://support.google.com/analytics/answer/7201382" target="_blank" rel="noopener noreferrer">GA4 DebugView</a></strong> te permite ver los eventos en tiempo real en GA4.</p>
        </div>

        <button class="btn-continue" onclick="startBloque2Game5()">
            MisiÃ³n 4: El radar no miente â†’
        </button>
    </div>
</section>

<!-- Mini-juego 5: El radar no miente -->
<section class="chapter intro-scene-section" id="bloque2-game-5" style="display: none;">
    <div class="narrative center-content">
        <h2> MisiÃ³n 4: El Radar No Miente</h2>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <p><strong>Reto prÃ¡ctico:</strong></p>
                <p>Se muestra un flujo donde algo falla. Identifica el error:</p>
                <ul style="padding-left: 1.5rem;">
                    <li>Evento no llega</li>
                    <li>Variable mal nombrada</li>
                    <li>Trigger no se activa</li>
                </ul>
            </div>
        </div>
        
        <div id="bloque2-game-5-container"></div>
    </div>
</section>

<!-- Parte TeÃ³rica 6: Estrategia y naming -->
<section class="chapter intro-scene-section" id="bloque2-theory-6" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ“œ El Archivo de la Torre (Gobernanza)</h2>
        <span class="intro-pill">Minijuego: El Archivero</span>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ§</div>
            <div class="narrator-text">
                <p><strong>Tu torre crece. Tus etiquetas se multiplican.</strong></p>
                <p>Si no eres ordenado, en 3 meses esto serÃ¡ un caos inmanejable.</p>
                <p><strong>Tu misiÃ³n:</strong> Auditar los nombres de las etiquetas entrantes. Solo aceptamos la convenciÃ³n sagrada:</p>
                <div style="background: #000; color: #0f0; padding: 0.5rem; margin: 0.5rem 0; font-family: monospace;">Proyecto - Herramienta - AcciÃ³n</div>
            </div>
        </div>

        <div id="archivist-game-container" style="min-height: 400px; padding: 1rem;">
            <button class="btn-primary" onclick="ARCHIVIST_GAME.init('archivist-game-container')">
                ğŸ‘®â€â™‚ï¸ Empezar AuditorÃ­a
            </button>
        </div>

        <div class="narrator-box" style="margin-top: 2rem; border-left: 4px solid #ff9800;">
            <div class="narrator-icon">âš ï¸</div>
            <div class="narrator-text">
                <p><strong>La Regla de Oro:</strong></p>
                <p>JamÃ¡s llames a un tag "Nuevo Tag". JamÃ¡s.</p>
                <p>Usa <code>MiWeb - GA4 - Purchase</code>.</p>
            </div>
        </div>

        <button class="btn-continue" onclick="showSecretTech()" style="margin-top: 2rem;">
            Continuar â†’
        </button>
    </div>
</section>

<!-- Bonus Level: Secret Tech -->
<section class="chapter intro-scene-section" id="bloque2-secret-tech" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ”“ SECRET TECH DESBLOQUEADO</h2>
        <span class="intro-pill" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: black;">Nivel Avanzado</span>

        <div class="narrator-box" style="background: linear-gradient(135deg, #222, #444); color: white; border: 2px solid #FFD700;">
            <div class="narrator-icon">ğŸ’</div>
            <div class="narrator-text">
                <h3>Has descubierto: User-Provided Data</h3>
                <p>Las cookies estÃ¡n muriendo. Pero los datos propios (1st party) son eternos.</p>
                <p>Ahora puedes configurar variables que capturan <strong>Email, TelÃ©fono y DirecciÃ³n</strong> (hasheados) para enviarlos a Google y Meta.</p>
                <p><strong>Efecto:</strong> +20% Conversiones atribuidas (Enhanced Conversions).</p>
            </div>
        </div>
        
        <button class="btn-continue" onclick="startBloque2Checklist()" style="margin-top: 2rem;">
            âœ… Ir al Checklist (Sensei Mode) â†’
        </button>
    </div>
</section>

<!-- Boss Fight: El evento fantasma -->
<section class="chapter intro-scene-section" id="bloque2-boss-fight" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 2.5rem; text-align: center; margin-bottom: 2rem;">ğŸ‘» Boss fight: el evento fantasma</h1>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ®</div>
            <div class="narrator-text">
                <h3>Reto final del bloque:</h3>
                <p>Hay una implementaciÃ³n "medio rota":</p>
                <ul style="padding-left: 1.5rem;">
                    <li>Evento mal nombrado</li>
                    <li>Variable duplicada</li>
                    <li>Trigger ambiguo</li>
                </ul>
                <p><strong>Encuentra el fallo y corrÃ­gelo paso a paso.</strong></p>
            </div>
        </div>
        
        <div id="bloque2-boss-fight-container"></div>
    </div>
</section>

<!-- Cierre del Bloque 2 -->
<!-- Nueva secciÃ³n: Checklist de implementaciÃ³n -->
<section class="chapter intro-scene-section" id="bloque2-checklist" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 2.5rem; text-align: center; margin-bottom: 2rem;">âœ… Checklist de implementaciÃ³n (modo sensei)</h1>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ‘¨â€ğŸ’»</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>"Si vas a lanzar un evento y no has hecho esta checklist...</p>
                <p>lo que estÃ¡s lanzando es caos."</p>
            </div>
        </div>

        <div id="checklist-container" style="margin-top: 3rem;">
            <div class="minigame-container">
                <h3 class="minigame-title">ğŸ” Valida tu implementaciÃ³n</h3>
                <p class="minigame-instructions">Cada punto se valida con un minitest. Si fallas, el evento no llegarÃ¡.</p>
                
                <div id="checklist-items" style="margin-top: 2rem;">
                    <!-- Los items se generarÃ¡n dinÃ¡micamente -->
                </div>
                
                <div id="checklist-result" style="display: none; margin-top: 3rem;"></div>
            </div>
        </div>
    </div>
</section>


<section class="chapter intro-scene-section" id="bloque2-final" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center;">ğŸ‰ Ya Hablas GTM</h1>

        <div class="welcome-final">
            <p>ğŸ† <strong>Â¡Felicidades!</strong> Has completado el Bloque 2.</p>
            
            <h3 style="margin-top: 2rem;">ğŸ“š Lo que has aprendido:</h3>
            <ul>
                <li>âœ… La anatomÃ­a de un evento</li>
                <li>âœ… CÃ³mo configurar triggers y variables con precisiÃ³n</li>
                <li>âœ… CÃ³mo lanzar y verificar tags</li>
                <li>âœ… CÃ³mo nombrar bien para que todo escale</li>
                <li>âœ… Debugging avanzado con GTM Debugger</li>
            </ul>
        </div>

        <div class="closing-message">
            <p>Hoy, ya no solo escuchas.</p>
            <p><strong>Hablas el idioma de GTM con fluidez.</strong></p>
        </div>

        <button class="btn-primary" style="margin-top: 3rem; font-size: 1.3rem;" onclick="startBloque3()">
            ğŸ‘‰ Siguiente misiÃ³n: El ojo que todo lo ve â†’
        </button>
    </div>
</section>

<!-- ========================================
     BLOQUE 3 â€” El ojo que todo lo ve: VerificaciÃ³n y QA
     ======================================== -->

<!-- Intro Bloque 3 -->
<section class="chapter intro-scene-section" id="bloque3-welcome" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ‘ï¸ Bloque 3: El ojo que todo lo ve</h1>
        <p style="text-align: center;"><span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text);">â±ï¸ ~25 min</span></p>
        
        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ‘ï¸</div>
            <div class="narrator-text">
                <p><strong>En este bloque vas a aprender a ver lo invisible.</strong></p>
                <p>Los eventos ya no son lÃ­neas de cÃ³digo: son pruebas de que tu mediciÃ³n funciona.</p>
                <p>DescubrirÃ¡s cÃ³mo validar lo que implementas, detectar errores antes de que cuesten dinero y convertirte en el "ojo que todo lo ve" dentro del equipo.</p>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 3rem;">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Narrador:</strong></p>
                <p>Has aprendido a hablar el idioma de GTM...</p>
                <p>Pero hablar no basta.</p>
                <p>Si no puedes ver y comprobar lo que estÃ¡s diciendo...</p>
                <p>...los datos no existen.</p>
            </div>
        </div>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ‘¨â€ğŸ’»</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>"Bienvenido a la sala de control real. AquÃ­ no basta con tener fe."</p>
                <p>"AquÃ­, o hay datos, o no hay nada."</p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3Theory1()">
            ğŸ” Comprender la verificaciÃ³n â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 1: Por quÃ© validar es clave -->
<section class="chapter intro-scene-section" id="bloque3-theory-1" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ“š Por quÃ© validar es clave</h2>

        <div class="narrator-box mentor-intro">
            <div class="narrator-icon">ğŸ§‘â€ğŸ«</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>La verificaciÃ³n no es un paso tÃ©cnico mÃ¡s.</p>
                <p><strong>Es la frontera entre un dato Ãºtil y un espejismo costoso.</strong></p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 3rem;">
            <h3>ğŸ“Œ Razones para QA:</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li>âœ… Los errores en tracking no siempre dan error visible</li>
                <li>âœ… Una etiqueta rota puede inflar o romper mÃ©tricas silenciosamente</li>
                <li>âœ… La validaciÃ³n permite prevenir problemas antes de escalar campaÃ±as</li>
                <li>âœ… QA = autonomÃ­a para no depender de "alguien de tech"</li>
            </ul>
        </div>

        <p style="text-align: center; margin: var(--space-lg) 0; font-size: 1.05rem; font-weight: 600;">
            ğŸš¨ Casos reales: Lo que cuesta un tracking roto
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin: var(--space-lg) 0;">
            <div style="background: rgba(244, 67, 54, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #f44336;">
                <h4 style="margin-top: 0; color: #f44336;">ğŸ’¥ Caso 1: Tag GA4 rompe silenciosamente</h4>
                <p style="font-size: 0.9rem;">
                    <strong>QuÃ© pasÃ³:</strong> Dev cambiÃ³ un DOM selector. La etiqueta de GA4 deja de capturar clics de compra.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Sin QA:</strong> Marketing ve conversiÃ³n a 0 despuÃ©s de 2 semanas. Ya perdieron â‚¬50k en ad spend inÃºtil. Se culpan mutuamente.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Con QA:</strong> Se detecta en 2 horas. Fix inmediato. PÃ©rdida = â‚¬0.
                </p>
            </div>
            <div style="background: rgba(33, 150, 243, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #2196f3;">
                <h4 style="margin-top: 0; color: #2196f3;">ğŸ’¥ Caso 2: Eventos duplicados</h4>
                <p style="font-size: 0.9rem;">
                    <strong>QuÃ© pasÃ³:</strong> Dos devs implementaron el mismo evento sin saber. Ahora se dispara 2x cada vez.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Sin QA:</strong> Analytics muestra conversiÃ³n duplicada. Marketing optimiza basÃ¡ndose en nÃºmeros falsos. ROI de campaÃ±as se ve 2x mejor. Invierte mÃ¡s dinero en lo que NO funciona.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Con QA:</strong> Se detecta antes de launch. Una reuniÃ³n de 15 min lo arregla.
                </p>
            </div>
            <div style="background: rgba(76, 175, 80, 0.08); padding: var(--space-md); border-radius: 10px; border-left: 4px solid #4caf50;">
                <h4 style="margin-top: 0; color: #4caf50;">âœ… Caso 3: ValidaciÃ³n previene desastres</h4>
                <p style="font-size: 0.9rem;">
                    <strong>QuÃ© pasÃ³:</strong> QA detecta que Meta Pixel no estÃ¡ tracking compras en iOS 14+.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>AcciÃ³n:</strong> Antes de escalar budget a Meta (que depende de esos eventos), arreglan el tracking. Evitan quemar â‚¬100k en anuncios sin mediciÃ³n.
                </p>
                <p style="font-size: 0.85rem; color: var(--text-light);">
                    <strong>Resultado:</strong> CampaÃ±as optimizadas desde el dÃ­a 1. ROI real, no "esperanza".
                </p>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>"Un marketer que no valida es como un piloto que no mira el radar."</strong></p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3Mission1()">
            ğŸ® Comenzar misiÃ³n: Encender la luz â†’
        </button>
    </div>
</section>

<!-- MisiÃ³n 1: Encender la luz -->
<section class="chapter intro-scene-section" id="bloque3-mission-1" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ§ª MisiÃ³n 1: Encender la luz</h2>

        <div class="narrator-box warning" style="margin-bottom: 3rem;">
            <div class="narrator-icon">âš ï¸</div>
            <div class="narrator-text">
                <p>Hay eventos flotando en la oscuridad...</p>
                <p><strong>Â¿CÃ³mo sabes si realmente existen?</strong></p>
            </div>
        </div>

        <div id="bloque3-game-1-container"></div>
    </div>
</section>

<!-- TeorÃ­a 2: Herramientas esenciales de QA -->
<section class="chapter intro-scene-section" id="bloque3-theory-2" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ› ï¸ Herramientas esenciales de QA</h2>

        <div class="narrator-box mentor-intro">
            <div class="narrator-icon">ğŸ§‘â€ğŸ«</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>Estas son tus armas para validar eventos:</p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 3rem;">
            <h3>ğŸ”§ Arsenal de validaciÃ³n:</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li style="margin: 1.5rem 0;">
                    <strong>ğŸŸ¡ Preview Mode GTM</strong><br>
                    Ver si el evento entra, quÃ© triggers se activan y quÃ© variables se leen.
                </li>
                <li style="margin: 1.5rem 0;">
                    <strong>ğŸ”µ Google Analytics 4 DebugView</strong><br>
                    Confirmar si GA4 recibe el evento y con quÃ© payload.
                </li>
                <li style="margin: 1.5rem 0;">
                    <strong>ğŸŸ¢ <a href="https://chromewebstore.google.com/detail/omnibug/bknpehncffejahipecakbfkomebjmokl" target="_blank" rel="noopener noreferrer">Omnibug</a> / <a href="https://tagassistant.google.com/" target="_blank" rel="noopener noreferrer">Tag Assistant</a></strong><br>
                    Analizar requests salientes, comprobar parÃ¡metros.
                </li>
                <li style="margin: 1.5rem 0;">
                    <strong>ğŸŸ  Network tab (DevTools)</strong><br>
                    Inspeccionar payloads de red directamente.
                </li>
                <li style="margin: 1.5rem 0;">
                    <strong>âšª Entornos staging vs producciÃ³n</strong><br>
                    Validar antes de lanzar.
                </li>
            </ul>
        </div>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ’¡</div>
            <div class="narrator-text">
                <h3>Bonus:</h3>
                <p>Comparar tiempos de envÃ­o, duplicados, parÃ¡metros ausentes.</p>
                <p>Revisar discrepancias entre herramientas.</p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3Mission2()">
            ğŸ® Comenzar misiÃ³n: Caza el evento fantasma â†’
        </button>
    </div>
</section>

<!-- MisiÃ³n 2: Caza el evento fantasma -->
<section class="chapter intro-scene-section" id="bloque3-mission-2" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ‘» MisiÃ³n 2: Caza el evento fantasma</h2>

        <div class="narrator-box warning" style="margin-bottom: 3rem;">
            <div class="narrator-icon">ğŸ•µï¸</div>
            <div class="narrator-text">
                <p>Hay un evento que aparece en GTM Preview...</p>
                <p><strong>...pero no llega a GA4.</strong></p>
                <p>Â¿DÃ³nde se pierde?</p>
            </div>
        </div>

        <div id="bloque3-game-2-container"></div>
    </div>
</section>

<!-- TeorÃ­a 3: ValidaciÃ³n cruzada -->
<section class="chapter intro-scene-section" id="bloque3-theory-3" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ”— ValidaciÃ³n cruzada</h2>

        <div class="narrator-box mentor-intro">
            <div class="narrator-icon">ğŸ§‘â€ğŸ«</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>Una validaciÃ³n sÃ³lida no depende de una sola herramienta.</p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 3rem;">
            <h3>ğŸ” LÃ³gica de QA robusta:</h3>
            <div class="mission-steps">
                <div class="step">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <strong>Validar en GTM Preview</strong>
                        <p>Que el evento entra y se activan triggers correctos</p>
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <strong>Validar en <a href="https://support.google.com/analytics/answer/7201382" target="_blank" rel="noopener noreferrer">GA4 DebugView</a></strong>
                        <p>Que el evento llega con los parÃ¡metros esperados</p>
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <strong>Validar en Network tab u Omnibug</strong>
                        <p>El payload real enviado</p>
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <div class="step-content">
                        <strong>Validar en el reporting</strong>
                        <p>Si aparece en los dashboards esperados (retrasado)</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“Š</div>
            <div class="narrator-text">
                <h3>Ejemplo real:</h3>
                <ul style="list-style: none; padding-left: 0;">
                    <li>âœ… Evento de compra â†’ visto en Preview</li>
                    <li>âŒ No llega a GA4 â†’ error en nombre de parÃ¡metro</li>
                    <li>ğŸ” Se detecta en Network â†’ parÃ¡metro mal escrito</li>
                    <li>âœ… CorrecciÃ³n â†’ validaciÃ³n final</li>
                </ul>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>"Si aprendes a seguir el rastro, ningÃºn error se esconde."</strong></p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3Mission3()">
            ğŸ® Comenzar misiÃ³n: Sigue el rastro â†’
        </button>
    </div>
</section>

<!-- MisiÃ³n 3: Sigue el rastro -->
<section class="chapter intro-scene-section" id="bloque3-mission-3" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ” MisiÃ³n 3: Sigue el rastro</h2>

        <div class="narrator-box warning" style="margin-bottom: 3rem;">
            <div class="narrator-icon">ğŸ§©</div>
            <div class="narrator-text">
                <p>Un embudo con 3 pasos. Uno estÃ¡ roto.</p>
                <p><strong>Usa las herramientas en orden para encontrarlo.</strong></p>
            </div>
        </div>

        <div id="bloque3-game-3-container"></div>
    </div>
</section>

<!-- TeorÃ­a 4: Validar en diferentes entornos -->
<section class="chapter intro-scene-section" id="bloque3-theory-4" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸŒ Validar en diferentes entornos</h2>

        <div class="narrator-box mentor-intro">
            <div class="narrator-icon">ğŸ§‘â€ğŸ«</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>No todo se valida igual en dev, staging y producciÃ³n.</p>
                <p><strong>Un funnel puede funcionar perfecto en staging y romperse en live.</strong></p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 3rem;">
            <h3>ğŸ“‹ Checklist de QA por entorno:</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li>âœ… Verificar snippet correcto y container ID</li>
                <li>âœ… Asegurar que cookies y consentimientos funcionan igual</li>
                <li>âœ… Revisar si hay bloqueadores (adblock, Safari ITP, etc.)</li>
                <li>âœ… Validar rutas de red y dominios correctos</li>
            </ul>
        </div>

        <div class="narrator-box warning" style="margin-top: 2rem;">
            <div class="narrator-icon">âš ï¸</div>
            <div class="narrator-text">
                <h3>Casos frecuentes:</h3>
                <ul>
                    <li>Eventos que desaparecen en producciÃ³n</li>
                    <li>Cambios en DOM que rompen triggers</li>
                    <li>Versiones antiguas de container activas</li>
                </ul>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>"El enemigo mÃ¡s astuto del tracking... es staging que no se parece a producciÃ³n."</strong></p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3Mission4()">
            ğŸ® Comenzar misiÃ³n: El bug de staging â†’
        </button>
    </div>
</section>

<!-- MisiÃ³n 4: El bug de staging -->
<section class="chapter intro-scene-section" id="bloque3-mission-4" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ› MisiÃ³n 4: El bug de staging</h2>

        <div class="narrator-box warning" style="margin-bottom: 3rem;">
            <div class="narrator-icon">ğŸ¤”</div>
            <div class="narrator-text">
                <p>Evento funciona perfectamente en staging...</p>
                <p><strong>...pero no aparece en producciÃ³n.</strong></p>
                <p>Â¿QuÃ© ha pasado?</p>
            </div>
        </div>

        <div id="bloque3-game-4-container"></div>
    </div>
</section>

<!-- TeorÃ­a 5: QA + Marketing -->
<section class="chapter intro-scene-section" id="bloque3-theory-5" style="display: none;">
    <div class="narrative center-content">
        <h2>ğŸ’¼ QA + Marketing (Valor estratÃ©gico)</h2>

        <div class="narrator-box mentor-intro">
            <div class="narrator-icon">ğŸ§‘â€ğŸ«</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p>Para un marketer, dominar QA significa:</p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 3rem;">
            <h3>ğŸ’ª Superpoderes del marketer con QA:</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li style="margin: 1rem 0;">âœ… Saber si tus campaÃ±as miden bien desde el dÃ­a 0</li>
                <li style="margin: 1rem 0;">âœ… Poder lanzar sin depender de desarrollo</li>
                <li style="margin: 1rem 0;">âœ… Entender los lÃ­mites de las plataformas</li>
                <li style="margin: 1rem 0;">âœ… Detectar problemas antes de que cuesten dinero</li>
            </ul>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>"Medir no es solo lanzar.</strong></p>
                <p><strong>Medir es confirmar que la historia que cuentan los datos... es real."</strong></p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque3BossFight()">
            âš”ï¸ Boss Fight: La historia rota â†’
        </button>
    </div>
</section>

<!-- Boss Fight: La historia rota -->
<section class="chapter intro-scene-section" id="bloque3-boss-fight" style="display: none;">
    <div class="narrative center-content">
        <h2>âš”ï¸ Boss Fight: La historia rota</h2>

        <div class="narrator-box warning" style="margin-bottom: 3rem;">
            <div class="narrator-icon">ğŸ¯</div>
            <div class="narrator-text">
                <h3>Reto final:</h3>
                <p>Una implementaciÃ³n con varios errores mezclados:</p>
                <ul>
                    <li>Naming inconsistente</li>
                    <li>Payload roto</li>
                    <li>Doble evento</li>
                </ul>
                <p><strong>Encuentra los fallos y documenta el QA paso a paso.</strong></p>
            </div>
        </div>
        
        <div id="bloque3-boss-fight-container"></div>
    </div>
</section>

<!-- Cierre del Bloque 3 -->
<section class="chapter intro-scene-section" id="bloque3-final" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center;">ğŸ‘ï¸ El ojo que todo lo ve</h1>

        <div class="welcome-final">
            <p>ğŸ† <strong>Â¡Felicidades!</strong> Has completado el Bloque 3.</p>
            
            <h3 style="margin-top: 2rem;">ğŸ“š Lo que has aprendido:</h3>
            <ul>
                <li>âœ… A usar las herramientas de QA en profundidad</li>
                <li>âœ… A validar datos en mÃºltiples capas y entornos</li>
                <li>âœ… A detectar eventos fantasmas y bugs reales</li>
                <li>âœ… A seguir el rastro de un dato desde GTM hasta reporting</li>
                <li>âœ… A ser autÃ³nomo en la validaciÃ³n sin depender de tech</li>
            </ul>
        </div>

        <div class="closing-message">
            <p>Ahora no solo hablas GTM...</p>
            <p><strong>Lo auditas como un pro.</strong></p>
        </div>

        <button class="btn-primary" style="margin-top: 3rem; font-size: 1.3rem;" onclick="startDemoLive()">
            ğŸ‘‰ Siguiente: Demo Live en GTM â†’
        </button>
    </div>
</section>

<!-- ============================================ -->
<!-- DEMO LIVE: IMPLEMENTACIONES REALES -->
<!-- ============================================ -->

<!-- Demo Live: Bienvenida -->
<section class="chapter intro-scene-section" id="demo-welcome" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ¬ Demo Live: GTM en AcciÃ³n</h1>
        <p style="text-align: center;"><span class="intro-pill" style="background: rgba(233, 30, 99, 0.15); color: var(--text);">ğŸ‘¨â€ğŸ« SecciÃ³n guiada por el profesor</span></p>
        
        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ¯</div>
            <div class="narrator-text">
                <p><strong>Ahora toca ver GTM en acciÃ³n real.</strong></p>
                <p>El profesor te guiarÃ¡ por las 3 implementaciones mÃ¡s comunes en marketing digital:</p>
            </div>
        </div>

        <div class="intro-grid-3" style="margin-top: var(--space-lg);">
            <article class="intro-card-motion" style="border-left: 4px solid #1877f2;">
                <h3>ğŸ“˜ Meta Pixel (Facebook)</h3>
                <p>PageView, ViewContent, AddToCart, Purchase, Lead y sus variantes.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">El pixel mÃ¡s usado en paid social.</p>
            </article>
            <article class="intro-card-motion" style="border-left: 4px solid #ff9800;">
                <h3>ğŸ“Š GA4: Lead & E-commerce</h3>
                <p>Eventos estÃ¡ndar para captaciÃ³n de leads y tiendas online.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">La base de toda mediciÃ³n moderna.</p>
            </article>
            <article class="intro-card-motion" style="border-left: 4px solid #00c853;">
                <h3>ğŸ”’ Meta CAPI (Server-side)</h3>
                <p>EnvÃ­o server-to-server para mejor atribuciÃ³n y privacidad.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">El futuro del tracking post-cookies.</p>
            </article>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="startDemoFacebook()">
            Empezar con Meta Pixel â†’
        </button>
    </div>
</section>

<!-- Demo 1: Meta Pixel (Facebook) -->
<section class="chapter intro-scene-section" id="demo-facebook" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ“˜ Demo 1: Meta Pixel (Facebook)</h2>
        <p style="text-align: center;"><span class="intro-pill">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</span></p>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ’¡</div>
            <div class="narrator-text">
                <p><strong>Â¿Por quÃ© Meta Pixel?</strong></p>
                <p>Es el tag mÃ¡s comÃºn en marketing. Si no lo configuras bien, tus campaÃ±as de Facebook/Instagram no optimizan correctamente y pierdes dinero en ads.</p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 2rem; background: rgba(24, 119, 242, 0.05); border: 2px solid #1877f2; padding: var(--space-lg); border-radius: 12px;">
            <h3 style="color: #1877f2; margin-top: 0;">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
            
            <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #1877f2;">1</span>
                    <div>
                        <strong>Crear el tag base de Meta Pixel</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Configurar el Pixel ID y el tag PageView que dispara en todas las pÃ¡ginas.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #1877f2;">2</span>
                    <div>
                        <strong>Eventos estÃ¡ndar de e-commerce</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);"><code>ViewContent</code> (ver producto), <code>AddToCart</code> (aÃ±adir al carrito), <code>InitiateCheckout</code>, <code>Purchase</code>.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #1877f2;">3</span>
                    <div>
                        <strong>Eventos de lead generation</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);"><code>Lead</code> (formulario enviado), <code>CompleteRegistration</code>, <code>Contact</code>.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #1877f2;">4</span>
                    <div>
                        <strong>ParÃ¡metros dinÃ¡micos</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Pasar <code>value</code>, <code>currency</code>, <code>content_ids</code> desde el dataLayer.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #1877f2;">5</span>
                    <div>
                        <strong>Verificar con <a href="https://chrome.google.com/webstore/detail/facebook-pixel-helper/fdgfkebogiimcoedlicjlajpkdmockpc" target="_blank" rel="noopener noreferrer">Facebook Pixel Helper</a></strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Usar la extensiÃ³n de Chrome para validar que todo funciona.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">âš ï¸</div>
            <div class="narrator-text">
                <h4 style="margin-top: 0; color: #e91e63;">Errores comunes que verÃ¡s en auditorÃ­as:</h4>
                <ul style="margin: var(--space-sm) 0; padding-left: 1.25rem;">
                    <li>âŒ Pixel duplicado (dispara 2 veces = datos inflados)</li>
                    <li>âŒ Purchase sin <code>value</code> (no puedes calcular ROAS)</li>
                    <li>âŒ Eventos en pÃ¡gina incorrecta (AddToCart en home)</li>
                    <li>âŒ No usar <code>content_ids</code> (remarketing dinÃ¡mico no funciona)</li>
                </ul>
            </div>
        </div>

        <div style="display: flex; gap: var(--space-md); justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
            <button class="btn-continue" onclick="startDemoGA4()">
                Siguiente: GA4 â†’
            </button>
        </div>
    </div>
</section>

<!-- Demo 2: GA4 Lead y E-commerce -->
<section class="chapter intro-scene-section" id="demo-ga4" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ“Š Demo 2: GA4 para Lead Gen y E-commerce</h2>
        <p style="text-align: center;"><span class="intro-pill">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</span></p>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ’¡</div>
            <div class="narrator-text">
                <p><strong>Â¿Por quÃ© GA4?</strong></p>
                <p>Es el estÃ¡ndar de mediciÃ³n de Google. Sin GA4 bien configurado, no tienes datos fiables para tomar decisiones ni para alimentar Google Ads.</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg); margin-top: var(--space-lg);">
            
            <!-- Lead Generation -->
            <div style="background: rgba(76, 175, 80, 0.05); border: 2px solid #4caf50; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #4caf50; margin-top: 0;">ğŸ“ Lead Generation</h3>
                <p style="font-size: 0.9rem; color: var(--text-light);">Para webs de servicios, B2B, inmobiliarias, etc.</p>
                
                <h4 style="margin-top: var(--space-md);">Eventos clave:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li><code>generate_lead</code> - Formulario enviado</li>
                    <li><code>sign_up</code> - Registro completado</li>
                    <li><code>contact</code> - Click en telÃ©fono/email</li>
                    <li><code>form_start</code> - EmpezÃ³ a rellenar</li>
                    <li><code>file_download</code> - DescargÃ³ PDF/catÃ¡logo</li>
                </ul>
                
                <h4 style="margin-top: var(--space-md);">ParÃ¡metros importantes:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li><code>form_id</code> - Identificar quÃ© formulario</li>
                    <li><code>form_name</code> - Nombre legible</li>
                    <li><code>value</code> - Valor estimado del lead</li>
                </ul>
            </div>

            <!-- E-commerce -->
            <div style="background: rgba(255, 152, 0, 0.05); border: 2px solid #ff9800; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #ff9800; margin-top: 0;">ğŸ›’ E-commerce</h3>
                <p style="font-size: 0.9rem; color: var(--text-light);">Para tiendas online, marketplaces, etc.</p>
                
                <h4 style="margin-top: var(--space-md);">Eventos del funnel:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li><code>view_item</code> - Vio un producto</li>
                    <li><code>add_to_cart</code> - AÃ±adiÃ³ al carrito</li>
                    <li><code>begin_checkout</code> - IniciÃ³ checkout</li>
                    <li><code>add_payment_info</code> - AÃ±adiÃ³ pago</li>
                    <li><code>purchase</code> - Compra completada</li>
                </ul>
                
                <h4 style="margin-top: var(--space-md);">ParÃ¡metros obligatorios:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li><code>items[]</code> - Array de productos</li>
                    <li><code>value</code> - Valor total</li>
                    <li><code>currency</code> - EUR, USD, etc.</li>
                    <li><code>transaction_id</code> - ID Ãºnico (solo purchase)</li>
                </ul>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 2rem; background: rgba(33, 150, 243, 0.05); border: 2px solid #2196f3; padding: var(--space-lg); border-radius: 12px;">
            <h3 style="color: #2196f3; margin-top: 0;">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
            <ol style="padding-left: 1.25rem;">
                <li>Crear tag GA4 Configuration con el Measurement ID</li>
                <li>Crear tag GA4 Event para <code>generate_lead</code></li>
                <li>Configurar el trigger (Form Submission)</li>
                <li>Pasar parÃ¡metros desde variables del dataLayer</li>
                <li>Verificar en <a href="https://support.google.com/analytics/answer/7201382" target="_blank" rel="noopener noreferrer">GA4 DebugView</a> que el evento llega</li>
                <li>Marcar el evento como conversiÃ³n en GA4</li>
            </ol>
        </div>

        <div style="display: flex; gap: var(--space-md); justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
            <button class="btn-continue" onclick="startDemoCAPI()">
                Siguiente: Meta CAPI â†’
            </button>
        </div>
    </div>
</section>

<!-- Demo 3: Meta CAPI (Server-side) -->
<section class="chapter intro-scene-section" id="demo-capi" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ”’ Demo 3: Meta CAPI (Server-side)</h2>
        <p style="text-align: center;"><span class="intro-pill">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</span></p>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ”®</div>
            <div class="narrator-text">
                <p><strong>Â¿Por quÃ© CAPI (Conversions API)?</strong></p>
                <p>Los navegadores bloquean cada vez mÃ¡s el tracking client-side (cookies, ad-blockers, ITP de Safari). CAPI envÃ­a datos directamente desde tu servidor a Meta, sin pasar por el navegador.</p>
                <p><strong>Resultado:</strong> Mejor atribuciÃ³n, mÃ¡s conversiones reportadas, mejor optimizaciÃ³n de campaÃ±as.</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md); margin-top: var(--space-lg);">
            <div class="intro-card-motion" style="background: rgba(244, 67, 54, 0.05); border-left: 4px solid #f44336;">
                <h4 style="margin-top: 0; color: #f44336;">âŒ Solo Pixel (Client-side)</h4>
                <ul style="font-size: 0.9rem; padding-left: 1rem; margin: 0;">
                    <li>Ad-blockers lo bloquean (~30% usuarios)</li>
                    <li>Safari ITP limita cookies a 7 dÃ­as</li>
                    <li>iOS 14.5+ pide permiso (50% dice no)</li>
                    <li>Pierdes ~40% de las conversiones</li>
                </ul>
            </div>
            <div class="intro-card-motion" style="background: rgba(76, 175, 80, 0.05); border-left: 4px solid #4caf50;">
                <h4 style="margin-top: 0; color: #4caf50;">âœ… Pixel + CAPI (HÃ­brido)</h4>
                <ul style="font-size: 0.9rem; padding-left: 1rem; margin: 0;">
                    <li>EnvÃ­o redundante (si uno falla, el otro llega)</li>
                    <li>Meta deduplica automÃ¡ticamente</li>
                    <li>Recuperas conversiones perdidas</li>
                    <li>Mejor Event Match Quality (EMQ)</li>
                </ul>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 2rem; background: rgba(0, 200, 83, 0.05); border: 2px solid #00c853; padding: var(--space-lg); border-radius: 12px;">
            <h3 style="color: #00c853; margin-top: 0;">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
            
            <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">1</span>
                    <div>
                        <strong>Arquitectura: Cliente + Servidor</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Web â†’ GTM Client â†’ GTM Server â†’ Meta CAPI</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">2</span>
                    <div>
                        <strong>Configurar GTM Server-side container</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Crear contenedor en <a href="https://cloud.google.com/run" target="_blank" rel="noopener noreferrer">Google Cloud</a> o <a href="https://stape.io" target="_blank" rel="noopener noreferrer">Stape.io</a>.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">3</span>
                    <div>
                        <strong>Enviar eventos desde GTM Web al Server</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Usar GA4 como "transport" o el cliente de Meta.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">4</span>
                    <div>
                        <strong>Configurar el tag de Meta CAPI en Server</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Pixel ID, Access Token, mapear eventos y parÃ¡metros.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">5</span>
                    <div>
                        <strong>DeduplicaciÃ³n con event_id</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Mismo <code>event_id</code> en Pixel y CAPI = Meta sabe que es el mismo evento.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">6</span>
                    <div>
                        <strong>Verificar en <a href="https://business.facebook.com/events_manager" target="_blank" rel="noopener noreferrer">Meta Events Manager</a></strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Ver Event Match Quality, deduplicaciÃ³n y eventos recibidos.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“Š</div>
            <div class="narrator-text">
                <h4 style="margin-top: 0;">MÃ©tricas clave en Meta Events Manager:</h4>
                <ul style="margin: var(--space-sm) 0; padding-left: 1.25rem;">
                    <li><strong>Event Match Quality (EMQ):</strong> Objetivo &gt; 6.0 (de 10)</li>
                    <li><strong>Deduplication:</strong> Debe mostrar "Deduplicated" en eventos</li>
                    <li><strong>Browser vs Server:</strong> Ver ambos canales enviando</li>
                </ul>
            </div>
        </div>

        <div style="display: flex; gap: var(--space-md); justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
            <button class="btn-primary" onclick="completeDemoLive()">
                Demos completadas â†’ Continuar a Funnels
            </button>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- BLOQUE 4 â€” ARQUITECTOS DEL FUNNEL -->
<!-- ============================================ -->

<!-- Bienvenida Bloque 4 -->
<section class="chapter intro-scene-section" id="bloque4-welcome" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ—ï¸ Bloque 4 â€” Arquitectos del Funnel</h1>
        <p style="text-align: center;"><span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text);">â±ï¸ ~25 min</span></p>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸ›ï¸</div>
            <div class="narrator-text">
                <p><strong>Los eventos son ladrillos. Los funnels, el plano.</strong></p>
                <p>Este bloque te enseÃ±a a diseÃ±ar estructuras de mediciÃ³n coherentes, escalables y alineadas con negocio.</p>
                <p>AprenderÃ¡s a mapear el viaje, detectar fugas y construir una arquitectura que otros equipos puedan seguir.</p>
            </div>
        </div>

        <p style="text-align: center; margin: var(--space-lg) 0; font-size: 1.05rem; max-width: 720px; margin-left: auto; margin-right: auto; color: var(--text-light);">
            <strong>Â¿Por quÃ© esto importa?</strong> Porque la diferencia entre "veo nÃºmeros" y "veo dÃ³nde se escapa el dinero" estÃ¡ en cÃ³mo diseÃ±as tus funnels. Un funnel mal diseÃ±ado te deja ciego. Un funnel bien diseÃ±ado te abre oportunidades de â‚¬â‚¬â‚¬.
        </p>
        
        <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Theory1()">
            Comenzar misiÃ³n â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 1: QuÃ© es un funnel -->
<section class="chapter intro-scene-section" id="bloque4-theory-1" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2>ğŸ§­ QuÃ© es un funnel (visiÃ³n estratÃ©gica)</h2>
            
            <div class="narrator-box mentor-intro">
                <div class="narrator-icon">ğŸ“</div>
                <div class="narrator-text">
                    <p><strong>Un funnel no es un dashboard bonito.</strong></p>
                    <p>Es la traducciÃ³n operativa de una intenciÃ³n de negocio.</p>
                </div>
            </div>
            
            <div class="mission-box" style="margin-top: 2rem;">
                <h3>ğŸ“Œ Fundamentos</h3>
                <ul class="mission-steps">
                    <li>âœ“ Representa pasos crÃ­ticos hacia un objetivo</li>
                    <li>âœ“ Cada paso es un evento medible</li>
                    <li>âœ“ Lo importante no es solo quÃ© hace el usuario, sino <strong>cuÃ¡ndo y en quÃ© orden</strong></li>
                    <li>âœ“ Un buen funnel permite detectar fricciones y oportunidades</li>
                </ul>
            </div>
            
            <div class="outcome-good" style="margin-top: 2rem;">
                <h3>ğŸ“Š Ejemplo de Funnel E-commerce</h3>
                <div style="font-family: monospace; padding: 1rem; background: #f8f8f8; border-radius: 8px;">
                    view_item â†’ add_to_cart â†’ begin_checkout â†’ purchase
                </div>
            </div>
            
            <div class="narrator-box analogy" style="margin-top: 2rem;">
                <div class="narrator-icon">ğŸ§ </div>
                <div class="narrator-text">
                    <strong>La diferencia clave:</strong><br>
                    Un <em>evento aislado</em> te dice que pasÃ³ algo.<br>
                    Un <em>funnel estructurado</em> te dice el camino completo.<br><br>
                    La conversiÃ³n es el resultado de un comportamiento, no de un botÃ³n.
                </div>
            </div>
            
            <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Mission1()">
                Continuar al reto â†’
            </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 1: Identificar evento faltante -->
<section class="chapter intro-scene-section" id="bloque4-mission-1" style="display: none;">
    <div class="center-content">
        <div id="bloque4-game-1-container"></div>
    </div>
</section>

<!-- TeorÃ­a 2: CÃ³mo mapear un funnel -->
<section class="chapter intro-scene-section" id="bloque4-theory-2" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2>ğŸ—ºï¸ CÃ³mo mapear un funnel (de idea a implementaciÃ³n)</h2>
            
            <div class="narrator-box mentor-intro">
                <div class="narrator-icon">ğŸ“</div>
                <div class="narrator-text">
                    <p><strong>El funnel empieza en un Excel o Figma, no en GTM.</strong></p>
                </div>
            </div>
            
            <div class="mission-box" style="margin-top: 2rem;">
                <h3>ğŸ“Œ Proceso de Mapeo</h3>
                <ol class="mission-steps">
                    <li><strong>Definir el objetivo de negocio</strong><br>
                        <small>Ej: vender entradas, captar leads, suscripciones</small>
                    </li>
                    <li><strong>Listar pasos crÃ­ticos</strong><br>
                        <small>Ej: pÃ¡gina de detalle â†’ aÃ±adir al carrito â†’ checkout</small>
                    </li>
                    <li><strong>Mapear eventos existentes y brechas</strong><br>
                        <small>Â¿QuÃ© ya mide? Â¿QuÃ© falta?</small>
                    </li>
                    <li><strong>DiseÃ±ar naming consistente</strong><br>
                        <small>Usar estÃ¡ndares (GA4, custom)</small>
                    </li>
                    <li><strong>Traducirlo a eventos medibles en GTM</strong><br>
                        <small>Triggers, variables, tags</small>
                    </li>
                </ol>
            </div>
            
            <div class="narrator-box">
                <div class="narrator-icon">ğŸ“œ</div>
                <div class="narrator-text">
                    <p><strong>"Un funnel bien diseÃ±ado es como un buen guion:</strong></p>
                    <p>cada escena lleva a la siguiente."</p>
                </div>
            </div>
            
            <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Mission2()">
                Continuar al reto â†’
            </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 2: Mapear eventos a pasos del funnel -->
<section class="chapter intro-scene-section" id="bloque4-mission-2" style="display: none;">
    <div class="center-content">
        <div id="bloque4-game-2-container"></div>
    </div>
</section>

<!-- TeorÃ­a 3: Estructura tÃ©cnica del funnel -->
<section class="chapter intro-scene-section" id="bloque4-theory-3" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2>âš™ï¸ Estructura tÃ©cnica del funnel (GTM + GA4)</h2>
            
            <div class="narrator-box mentor-intro">
                <div class="narrator-icon">ğŸ“</div>
                <div class="narrator-text">
                    <p><strong>Un funnel operativo vive en dos mundos:</strong></p>
                    <ul style="margin-top: 1rem;">
                        <li><strong>GTM:</strong> donde escuchas y defines los eventos</li>
                        <li><strong>GA4 (o similar):</strong> donde los analizas</li>
                    </ul>
                </div>
            </div>
            
            <div class="mission-box" style="margin-top: 2rem;">
                <h3>ğŸ“Œ Estructura Base</h3>
                <ul class="mission-steps">
                    <li>âœ“ <strong>Naming estandarizado</strong> (view_item, add_to_cartâ€¦)</li>
                    <li>âœ“ <strong>Uso correcto de parÃ¡metros</strong> (items, value, currencyâ€¦)</li>
                    <li>âœ“ <strong>AlineaciÃ³n con modelos de anÃ¡lisis</strong> (Exploraciones, Conversion Funnels en GA4)</li>
                    <li>âœ“ <strong>Evitar duplicaciones</strong> y eventos fuera de secuencia</li>
                </ul>
            </div>
            
            <div class="narrator-box warning" style="margin-top: 2rem;">
                <div class="narrator-icon">âš ï¸</div>
                <div class="narrator-text">
                    <p><strong>Punto crÃ­tico:</strong></p>
                    <p>Los funnels no se "arreglan" en GA4.</p>
                    <p>Se arreglan en <strong>cÃ³mo los envÃ­as desde GTM</strong>.</p>
                </div>
            </div>
            
            <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Mission3()">
                Continuar al reto â†’
            </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 3: Detectar funnel roto -->
<section class="chapter intro-scene-section" id="bloque4-mission-3" style="display: none;">
    <div class="center-content">
        <div id="bloque4-game-3-container"></div>
    </div>
</section>

<!-- TeorÃ­a 4: Naming & Governance -->
<section class="chapter intro-scene-section" id="bloque4-theory-4" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2>ğŸ“š Naming & Governance (profundidad tÃ¡ctica)</h2>
            
            <div class="narrator-box mentor-intro">
                <div class="narrator-icon">ğŸ“</div>
                <div class="narrator-text">
                    <p><strong>No hay funnel sÃ³lido sin nomenclatura sÃ³lida.</strong></p>
                    <p>Un nombre inconsistente hoy = 100 dashboards rotos maÃ±ana.</p>
                </div>
            </div>
            
            <div class="mission-box" style="margin-top: 2rem;">
                <h3>ğŸ“Œ Buenas PrÃ¡cticas</h3>
                <ul class="mission-steps">
                    <li>âœ“ <strong>EstÃ¡ndares GA4</strong> â†’ view_item, add_to_cart, etc.</li>
                    <li>âœ“ <strong>Evitar camelCase aleatorio</strong></li>
                    <li>âœ“ <strong>Usar parÃ¡metros obligatorios</strong> (ej. items, value)</li>
                    <li>âœ“ <strong>Documentar cada evento</strong> y su propÃ³sito</li>
                </ul>
            </div>
            
            <div class="narrator-box">
                <div class="narrator-icon">ğŸ“œ</div>
                <div class="narrator-text">
                    <p><strong>"Nombrar no es un trÃ¡mite.</strong></p>
                    <p>Es una decisiÃ³n estratÃ©gica."</p>
                </div>
            </div>
            
            <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Mission4()">
                Continuar al reto â†’
            </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 4: Normalizar eventos -->
<section class="chapter intro-scene-section" id="bloque4-mission-4" style="display: none;">
    <div class="center-content">
        <div id="bloque4-game-4-container"></div>
    </div>
</section>

<!-- TeorÃ­a 5: Medir embudos reales -->
<section class="chapter intro-scene-section" id="bloque4-theory-5" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2>ğŸ“Š Medir embudos reales (de QA a reporting)</h2>
            
            <div class="narrator-box mentor-intro">
                <div class="narrator-icon">ğŸ“</div>
                <div class="narrator-text">
                    <p><strong>Medir un funnel no es solo implementarlo:</strong></p>
                    <p>hay que verificarlo, entenderlo y analizarlo.</p>
                </div>
            </div>
            
            <div class="mission-box" style="margin-top: 2rem;">
                <h3>ğŸ“Œ Pasos para Medir</h3>
                <ol class="mission-steps">
                    <li><strong>QA en GTM</strong> (Preview Mode, DebugView)</li>
                    <li><strong>QA cruzado</strong> (Network / Tag Assistant)</li>
                    <li><strong>ValidaciÃ³n en <a href="https://support.google.com/analytics/answer/7201382" target="_blank" rel="noopener noreferrer">GA4 DebugView</a></strong></li>
                    <li><strong>Reporting en GA4 Explorations</strong> (Funnel Exploration)</li>
                    <li><strong>Comparar comportamiento real con el diseÃ±o original</strong></li>
                </ol>
            </div>
            
            <div class="outcome-good" style="margin-top: 2rem;">
                <h3>ğŸ’¡ Tip Pro</h3>
                <p>
                    Usar "Funnel Steps" personalizados en GA4 y Debug para detectar cuellos de botella.
                </p>
            </div>
            
            <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque4Mission5()">
                Continuar al reto â†’
            </button>
        </div>
    </div>
</section>

<!-- MisiÃ³n 5: Detective de embudos -->
<section class="chapter intro-scene-section" id="bloque4-mission-5" style="display: none;">
    <div class="center-content">
        <div id="bloque4-game-5-container"></div>
    </div>
</section>

<!-- Boss Fight: El embudo que no embuda -->
<section class="chapter intro-scene-section" id="bloque4-boss-fight" style="display: none;">
    <div class="center-content">
        <div class="narrative">
            <h2 style="color: var(--danger); text-align: center;">âš”ï¸ Boss Fight â€” El embudo que no embuda</h2>
            
            <div class="narrator-box warning">
                <div class="narrator-icon">ğŸ®</div>
                <div class="narrator-text">
                    <p><strong>Escenario final:</strong></p>
                    <p>
                        Funnel de e-commerce con errores mezclados: duplicados, triggers flojos, 
                        naming inconsistente y parÃ¡metros mal pasados.
                    </p>
                    <p style="margin-top: 1rem;">
                        Debes corregir GTM, validar y comprobar en DebugView que el embudo fluye correctamente.
                    </p>
                </div>
            </div>
        </div>
        
        <div id="bloque4-boss-fight-container"></div>
    </div>
</section>

<!-- Cierre del Bloque 4 -->
<section class="chapter intro-scene-section" id="bloque4-final" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center;">ğŸ—ï¸ Arquitectos del Funnel</h1>

        <div class="welcome-final">
            <p>ğŸ† <strong>Â¡Felicidades!</strong> Has completado el Bloque 4.</p>
            
            <h3 style="margin-top: 2rem;">ğŸ“š Lo que has aprendido:</h3>
            <ul>
                <li>âœ… A traducir objetivos de negocio en funnels claros</li>
                <li>âœ… A estructurar eventos que construyen caminos reales</li>
                <li>âœ… A nombrar y gobernar tus datos</li>
                <li>âœ… A validar que lo que mides... es lo que pasa</li>
            </ul>
        </div>

        <div class="narrator-box">
            <div class="narrator-icon">ğŸ“œ</div>
            <div class="narrator-text">
                <p><strong>Ya no eres un simple oyente de GTM.</strong></p>
                <p>Eres un arquitecto de experiencias medibles.</p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 3rem; font-size: 1.3rem;" onclick="startBloque5()">
            ğŸ‘‰ Siguiente misiÃ³n: Escuchar al dato ğŸ§ â†’
        </button>
    </div>
</section>


<!-- Chapter 1: El Caos (DEPRECATED - usar Bloque 2) -->
<section class="chapter" id="chapter-1" style="display: none;">
                <div class="narrative">
                    <h2>ğŸŒ€ CapÃ­tulo 1 â€” El Caos Antes de GTM</h2>
                    
                    <p>
                        En toda organizaciÃ³n, el tracking nace mal. O mejor dicho: <b>nace sin dueÃ±o</b>.
                    </p>
                    
                    <p>
                        Marketing quiere lanzar campaÃ±as y necesita pÃ­xeles cuanto antes. Producto quiere mapear 
                        journeys en Hotjar. Legal grita "RGPD" y no entiende quÃ© hace Facebook en el checkout. 
                        Nadie habla el mismo idioma, pero todos quieren resultados "ya".
                    </p>
                    
                    <p>
                        El cÃ³digo se llena de fragmentos, scripts duplicados, etiquetas sin consentimiento ni control. 
                        Los dashboards se llenan de datos contradictorios que nadie puede explicar. Y cuando llegan 
                        las auditorÃ­asâ€¦ <b>nadie sabe quiÃ©n puso quÃ© ni por quÃ©</b>.
                    </p>
                    
                    <p>
                        AquÃ­ empieza el viaje. No con GTM, sino con el reconocimiento de que hay un problema estructural.
                    </p>
                </div>

                <div class="narrator-box" style="margin: 2rem 0;">
                    <div class="narrator-icon">ğŸ”¥</div>
                    <div class="narrator-text">
                        <p><strong>EstÃ¡s en medio de un fuego cruzado.</strong></p>
                        <p>Marketing quiere campaÃ±as ya. Producto necesita herramientas. Legal exige cumplimiento.</p>
                        <p>El cÃ³digo es un collage de scripts y nadie sabe quiÃ©n controla quÃ©.</p>
                    </div>
                </div>

                <div class="narrative">
                    <p class="question">
                        <b>EstÃ¡s en medio de un fuego cruzado. Marketing quiere campaÃ±as, Producto quiere herramientas, 
                        Legal exige cumplimiento. No hay un sistema, solo parches y prisas.</b>
                    </p>
                    
                    <p>Â¿QuÃ© haces?</p>
                </div>

                <!-- Choices -->
                <div class="choices">
                    <button class="choice-btn" onclick="makeChoice(1, 'manual')">
                        <span class="choice-number">1</span>
                        <span class="choice-text">AÃ±adir todo manualmente al cÃ³digo</span>
                    </button>
                    <button class="choice-btn" onclick="makeChoice(1, 'gtm')">
                        <span class="choice-number">2</span>
                        <span class="choice-text">Proponer GTM para orquestar</span>
                    </button>
                </div>

                <!-- Outcome text (hidden initially) -->
                <div class="outcome" id="outcome-1-manual">
                    <div class="outcome-bad">
                        <h3>âŒ El Caos se Multiplica</h3>
                        <p>
                            Las etiquetas insertadas a mano en distintas bases de cÃ³digo fragmentan la gobernanza. 
                            Los duplicados y condiciones de carrera inflan las mÃ©tricas. El riesgo legal crece 
                            cuando la lÃ³gica de consentimiento diverge por equipo.
                        </p>
                        <p class="lesson">
                            <b>LecciÃ³n:</b> Sin centralizaciÃ³n, cada equipo implementa tags de forma independiente, 
                            generando race conditions y dificultando el cumplimiento RGPD.
                        </p>
                    </div>
                </div>

                <div class="outcome" id="outcome-1-gtm">
                    <div class="outcome-good">
                        <h3>âœ… Un Primer Orden</h3>
                        <p>
                            Un Tag Manager centraliza dÃ³nde, cuÃ¡ndo y cÃ³mo se disparan los tags. Reduces duplicados 
                            y alineas el consentimiento en un solo lugar. Esta es la base para una mediciÃ³n escalable y legal.
                        </p>
                        <p class="lesson">
                            <b>LecciÃ³n:</b> GTM actÃºa como una capa de orquestaciÃ³n: dataLayer â†’ reglas â†’ tags. 
                            Permite versioning, testing en preview, y rollback sin deployar cÃ³digo.
                        </p>
                    </div>
                </div>

                <div class="narrative conclusion" id="conclusion-1">
                    <p>
                        <b>El caos no es tÃ©cnico, sino estructural.</b> Ahora sabes por quÃ© GTM existe.
                    </p>
                    
                    <!-- Theory Section -->
                    <div class="theory-section">
                        <h3>ğŸ’¡ Fundamentos de GTM</h3>
                        <p>Antes de continuar, vamos a entender los 3 pilares fundamentales de Google Tag Manager.</p>
                        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('afterChapter1', event); return false;">
                            ğŸ“š Ver conceptos: tags, triggers y variables
                        </button>
                    </div>
                    
                    <button class="btn-continue" onclick="nextChapter(2)">
                        Continuar al CapÃ­tulo 2 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 2: Ordenando la Casa -->
            <section class="chapter" id="chapter-2" style="display: none;">
                <div class="narrative">
                    <h2>ğŸ§­ CapÃ­tulo 2 â€” Ordenando la Casa</h2>
                    
                    <p>
                        La primera versiÃ³n de GTM no es un gran sistema, sino un <b>acto de diseÃ±o mÃ­nimo</b>: 
                        separar etiquetas, definir triggers bÃ¡sicos y recuperar el control.
                    </p>
                    
                    <p>
                        Es aquÃ­ donde se introduce la idea de sistema: que un contenedor bien diseÃ±ado no es un 
                        montÃ³n de etiquetas, sino una coreografÃ­a simple que permite escalar despuÃ©s.
                    </p>
                    
                    <p>
                        El caos deja de ser inevitable. Aparece el primer orden.
                    </p>
                    
                    <p class="question">
                        <b>Decidiste crear un contenedor. Ahora tienes que decidir cÃ³mo lo estructuras. 
                        Este es el primer paso real: pasar de "poner etiquetas" a "diseÃ±ar arquitectura".</b>
                    </p>
                    
                    <p>Â¿CÃ³mo empiezas?</p>
                </div>

                <div class="choices">
                    <button class="choice-btn" onclick="makeChoice(2, 'monolith')">
                        <span class="choice-number">1</span>
                        <span class="choice-text">Meter todo en una Ãºnica etiqueta gorda con mucho JS</span>
                    </button>
                    <button class="choice-btn" onclick="makeChoice(2, 'modular')">
                        <span class="choice-number">2</span>
                        <span class="choice-text">Separar etiquetas, triggers y variables bÃ¡sicas bien nombradas</span>
                    </button>
                </div>

                <div class="outcome" id="outcome-2-monolith">
                    <div class="outcome-bad">
                        <h3>âŒ Deuda TÃ©cnica</h3>
                        <p>
                            Una etiqueta monolÃ­tica complica el QA y el versionado. MÃ¡s JS = mÃ¡s probabilidad 
                            de errores y deuda tÃ©cnica inmediata.
                        </p>
                    </div>
                </div>

                <div class="outcome" id="outcome-2-modular">
                    <div class="outcome-good">
                        <h3>âœ… Arquitectura Escalable</h3>
                        <p>
                            Separar etiquetas por herramienta facilita control y pruebas. Variables bÃ¡sicas 
                            (URL, click, page_path) cubren el 80% de casos. Primer estÃ¡ndar: nombres claros y consistentes.
                        </p>
                    </div>
                </div>

                <div class="narrative conclusion" id="conclusion-2">
                    <p>
                        <b>Las decisiones iniciales definen el escalado futuro.</b> Ya no hay caos, hay arquitectura.
                    </p>
                    
                    <!-- Theory Section -->
                    <div class="theory-section">
                        <h3>ğŸ’¡ El DataLayer: Tu Despensa de Datos</h3>
                        <p>Ahora que tienes arquitectura, necesitas entender el corazÃ³n de GTM: el DataLayer.</p>
                        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('afterChapter2', event); return false;">
                            ğŸ“š Ver Conceptos: DataLayer y Variables Avanzadas
                        </button>
                    </div>
                    
                    <button class="btn-continue" onclick="nextChapter(3)">
                        Continuar al CapÃ­tulo 3 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 3: Gobernanza -->
            <section class="chapter" id="chapter-3" style="display: none;">
                <div class="narrative">
                    <h2>ğŸ§­ CapÃ­tulo 3 â€” Gobernanza</h2>
                    
                    <p>
                        <b>Un sistema sin normas es solo un caos mÃ¡s lento.</b>
                    </p>
                    
                    <p>
                        Cuando el sistema empieza a crecer, el problema ya no es tÃ©cnico: es humano. 
                        Cada equipo nombra como quiere, duplica triggers, pisa etiquetas. Lo que naciÃ³ ordenado 
                        amenaza con desbordarse.
                    </p>
                    
                    <p>
                        La gobernanza no es burocracia, sino la gramÃ¡tica del sistema: naming consistente, 
                        modularidad, plantillas reutilizables y QA compartido.
                    </p>
                    
                    <p class="question">
                        <b>Tu contenedor funciona. Pero la organizaciÃ³n crece. MÃ¡s equipos. MÃ¡s etiquetas. 
                        MÃ¡s caos potencial. Ya no basta con buenas intenciones: necesitas normas.</b>
                    </p>
                    
                    <p>Â¿QuÃ© haces?</p>
                </div>

                <div class="choices">
                    <button class="choice-btn" onclick="makeChoice(3, 'free')">
                        <span class="choice-number">1</span>
                        <span class="choice-text">Que cada uno nombre como quiera (rÃ¡pido ahora, ya ordenaremos...)</span>
                    </button>
                    <button class="choice-btn" onclick="makeChoice(3, 'standards')">
                        <span class="choice-number">2</span>
                        <span class="choice-text">Definir estÃ¡ndar de nombres + plantillas reutilizables</span>
                    </button>
                </div>

                <div class="outcome" id="outcome-3-free">
                    <div class="outcome-bad">
                        <h3>âŒ Caos Organizacional</h3>
                        <p>
                            Sin naming estÃ¡ndar no hay bÃºsqueda ni mantenimiento posible. Duplicados y colisiones 
                            de triggers son inevitables. Gobernanza tardÃ­a = refactor caro.
                        </p>
                    </div>
                </div>

                <div class="outcome" id="outcome-3-standards">
                    <div class="outcome-good">
                        <h3>âœ… Lenguaje ComÃºn</h3>
                        <p>
                            EstÃ¡ndar = descubribilidad, QA y handover sencillos. Plantillas (variables, triggers) 
                            aceleran el onboarding. Documentar anti-patrones evita repetir errores.
                        </p>
                    </div>
                </div>

                <div class="narrative conclusion" id="conclusion-3">
                    <p>
                        <b>La gobernanza no es burocracia, es la gramÃ¡tica del sistema.</b> Ya tienes un lenguaje comÃºn.
                    </p>
                    
                    <!-- Theory Section -->
                    <div class="theory-section">
                        <h3>ğŸ’¡ Mejores PrÃ¡cticas y Workflow Profesional</h3>
                        <p>Con gobernanza establecida, veamos cÃ³mo trabajar como profesionales de GTM.</p>
                        <button type="button" class="btn-theory-inline" onclick="showTheoryModal('afterChapter3', event); return false;">
                            ğŸ“š Ver Conceptos: Nomenclatura, Preview y Debugging
                        </button>
                    </div>
                    
                    <button class="btn-continue" onclick="nextChapter(4)">
                        Continuar al CapÃ­tulo 4 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 4: La Ley (En construcciÃ³n) -->
            <section class="chapter" id="chapter-4" style="display: none;">
                <div class="narrative">
                    <h2>âš–ï¸ CapÃ­tulo 4 â€” La Ley</h2>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">ğŸš§</div>
                        <h3>PrÃ³ximamente...</h3>
                        <p>
                            Este capÃ­tulo cubrirÃ¡ RGPD, consentimiento, Consent Mode v2, 
                            y cÃ³mo GTM te ayuda a cumplir con la normativa europea.
                        </p>
                        <ul>
                            <li>RGPD y cookies de tercera parte</li>
                            <li>Consent Mode v2 de Google</li>
                            <li>ImplementaciÃ³n de CMPs con GTM</li>
                            <li>AuditorÃ­as de privacidad</li>
                        </ul>
                    </div>
                </div>
                
                <div class="narrative">
                    <button class="btn-continue" onclick="nextChapter(5)">
                        Continuar al CapÃ­tulo 5 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 5: Integraciones (En construcciÃ³n) -->
            <section class="chapter" id="chapter-5" style="display: none;">
                <div class="narrative">
                    <h2>ğŸ”Œ CapÃ­tulo 5 â€” Integraciones</h2>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">ğŸš§</div>
                        <h3>PrÃ³ximamente...</h3>
                        <p>
                            Este capÃ­tulo explorarÃ¡ las integraciones mÃ¡s comunes con GTM 
                            y cÃ³mo configurarlas correctamente.
                        </p>
                        <ul>
                            <li>Google Analytics 4 (GA4)</li>
                            <li>Google Ads y Enhanced Conversions</li>
                            <li>Meta Pixel y Conversions API</li>
                            <li>LinkedIn, TikTok, y otras plataformas</li>
                        </ul>
                    </div>
                </div>
                
                <div class="narrative">
                    <button class="btn-continue" onclick="nextChapter(6)">
                        Continuar al CapÃ­tulo 6 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 6: Server-side (En construcciÃ³n) -->
            <section class="chapter" id="chapter-6" style="display: none;">
                <div class="narrative">
                    <h2>ğŸ–¥ï¸ CapÃ­tulo 6 â€” Server-side Tagging</h2>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">ğŸš§</div>
                        <h3>PrÃ³ximamente...</h3>
                        <p>
                            Este capÃ­tulo introducirÃ¡ el GTM Server-side y cÃ³mo puede 
                            mejorar performance, privacidad y control.
                        </p>
                        <ul>
                            <li>Â¿QuÃ© es GTM Server-side?</li>
                            <li>Arquitectura y configuraciÃ³n</li>
                            <li>Beneficios: performance, privacidad, datos first-party</li>
                            <li>Casos de uso avanzados</li>
                        </ul>
                    </div>
                </div>
                
                <div class="narrative">
                    <button class="btn-continue" onclick="nextChapter(7)">
                        Continuar al CapÃ­tulo 7 â†’
                    </button>
                </div>
            </section>

            <!-- Chapter 7: Orquestar (En construcciÃ³n) -->
            <section class="chapter" id="chapter-7" style="display: none;">
                <div class="narrative">
                    <h2>ğŸ¼ CapÃ­tulo 7 â€” Orquestar Todo</h2>
                    
                    <div class="coming-soon">
                        <div class="coming-soon-icon">ğŸš§</div>
                        <h3>PrÃ³ximamente...</h3>
                        <p>
                            El capÃ­tulo final unirÃ¡ todo: cÃ³mo escalar GTM en organizaciones 
                            grandes con mÃºltiples equipos y productos.
                        </p>
                        <ul>
                            <li>Estrategia multi-contenedor</li>
                            <li>Custom Templates y reutilizaciÃ³n</li>
                            <li>Monitoreo y alertas</li>
                            <li>El futuro del tagging</li>
                        </ul>
                    </div>
                </div>
                
                <div class="narrative">
                    <button class="btn-continue" onclick="showFinalScreen()">
                        Ver pantalla final â†’
                    </button>
                </div>
            </section>

            <!-- Final Screen -->
            <section class="chapter" id="chapter-final" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ‰ Â¡Has completado el viaje!</h2>
                    <p>
                        Ahora entiendes por quÃ© GTM no es solo una herramienta, sino una arquitectura de sentido.
                    </p>
                    <button class="btn-primary" onclick="restart()">
                        ğŸ”„ Volver a Empezar
                    </button>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- BLOQUE 5 â€” ESCUCHAR AL DATO -->
            <!-- ============================================ -->

            <!-- Bienvenida Bloque 5 -->
            <section class="chapter intro-scene-section" id="bloque5-welcome" style="display: none;">
                <div class="narrative center-content">
                    <h1 style="font-size: 3rem; margin-bottom: 1rem;">ğŸ§ Bloque 5 â€” Escuchar al dato</h1>
                    <p style="text-align: center;"><span class="intro-pill" style="background: rgba(78, 205, 196, 0.15); color: var(--text);">â±ï¸ ~20 min</span></p>
                    
                    <div class="narrator-box">
                        <div class="narrator-icon">ğŸŒ†</div>
                        <div class="narrator-text">
                            <p>Una oficina digital al amanecer. Nuestro aprendiz de marketing abre la pantalla del ordenador.</p>
                            <p>DetrÃ¡s de Ã©l, un rÃ­o invisible fluye sin descanso: cada clic, cada scroll, cada compra, cada abandono...</p>
                            <p><strong>Miles de seÃ±ales que hablan, aunque nadie las escuche.</strong></p>
                        </div>
                    </div>
                    
                    <div class="narrator-box" style="margin-top: 2rem;">
                        <div class="narrator-icon">ğŸ“–</div>
                        <div class="narrator-text">
                            <p>Durante semanas, has trabajado para que estas seÃ±ales lleguen a ti.</p>
                            <p>Has aprendido a colocar etiquetas, a activar triggers, a domar variables.</p>
                            <p>Ahora, por fin, el sistema habla.</p>
                            <br>
                            <p style="font-size: 1.2rem; color: var(--accent-red);"><strong>Pero hay un problemaâ€¦</strong></p>
                            <br>
                            <p style="font-style: italic;">ğŸ§ Silencio. Ruido blanco. Un zumbido confuso.</p>
                            <br>
                            <p><strong>"El dato hablaâ€¦ pero no dice nada. No si no sabes escucharlo."</strong></p>
                        </div>
                    </div>
                    
                    <button class="btn-primary" style="margin-top: 3rem;" onclick="startBloque5Game1()">
                        ğŸ¯ Comenzar: De recolectar a interpretar â†’
                    </button>
                </div>
            </section>

            <!-- MisiÃ³n 1: AtribuciÃ³n -->
            <section class="chapter intro-scene-section" id="bloque5-game-1" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ“Š MisiÃ³n 1: Â¿De dÃ³nde vienen las conversiones?</h2>
                    
                    <div class="narrator-box">
                        <div class="narrator-icon">ğŸ“–</div>
                        <div class="narrator-text">
                            <p>Un evento no sirve si no sabes dÃ³nde mirarlo.</p>
                            <p>Un funnel no significa nada si no sabes quÃ© representa.</p>
                            <p>Una conversiÃ³n es solo una palabra si no entiendes de dÃ³nde viene.</p>
                        </div>
                    </div>
                    
                    <div id="bloque5-game-1-container"></div>
                </div>
            </section>

            <!-- TeorÃ­a 2: Herramientas para escuchar -->
            <section class="chapter intro-scene-section" id="bloque5-theory-2" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ§­ Herramientas para "escuchar"</h2>
                    
                    <div class="theory-card">
                        <p>Para poder escuchar, necesitas un instrumento.</p>
                        <p>AquÃ­ entran en juego las herramientas analÃ­ticas:</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                            <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                                <h4 style="margin-bottom: 1rem;">ğŸ“Š Google Analytics 4</h4>
                                <p style="font-size: 0.95rem; color: var(--text-light);">La mÃ¡s comÃºn, perfecta para leer eventos bÃ¡sicos y entender flujos de usuario.</p>
                            </div>
                            
                            <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #4285f4;">
                                <h4 style="margin-bottom: 1rem;">ğŸ§­ Looker Studio</h4>
                                <p style="font-size: 0.95rem; color: var(--text-light);">La capa de visualizaciÃ³n â€” donde los datos empiezan a hablar con voz clara.</p>
                            </div>
                            
                            <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #9c27b0;">
                                <h4 style="margin-bottom: 1rem;">ğŸ§  Mixpanel</h4>
                                <p style="font-size: 0.95rem; color: var(--text-light);">Para anÃ¡lisis centrados en producto y comportamiento de usuario.</p>
                            </div>
                        </div>
                        
                        <div class="narrator-box" style="margin-top: 2rem;">
                            <div class="narrator-icon">ğŸ“–</div>
                            <div class="narrator-text">
                                <p>"AquÃ­ no vamos a hacer ingenierÃ­a de datos. Vamos a aprender a <strong>leer</strong>."</p>
                                <p>"A identificar patrones. A saber si algo va bien o mal sin depender de un analista sÃ©nior."</p>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                            <p><strong>ğŸ’¡ Ejemplo prÃ¡ctico:</strong></p>
                            <p>Un evento <code>purchase</code> llega con 100 hits diarios, pero solo 20 inician <code>begin_checkout</code>.</p>
                            <p style="margin-top: 1rem; color: var(--accent-red);"><strong>Â¿QuÃ© estÃ¡ pasando?</strong></p>
                            <p style="margin-top: 1rem; font-style: italic;">â†’ Este tipo de preguntas son las que empiezan a dar sentido al trabajo previo.</p>
                        </div>
                        
                        <button class="btn-continue" style="margin-top: 2rem;" onclick="startBloque5Game2()">
                            Continuar: Los funnels â†’
                        </button>
                    </div>
                </div>
            </section>

            <!-- MisiÃ³n 2: Detectar errores en funnel -->
            <section class="chapter intro-scene-section" id="bloque5-game-2" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ” MisiÃ³n 2: Los funnels â€” Â¿DÃ³nde se pierden?</h2>
                    
                    <div class="narrator-box">
                        <div class="narrator-icon">ğŸ“–</div>
                        <div class="narrator-text">
                            <p>"Los funnels son como mapas de carreteras."</p>
                            <p>"Saber cuÃ¡ntos llegan al destino es fÃ¡cil."</p>
                            <p><strong>"Entender por quÃ© los demÃ¡s se pierdenâ€¦ ahÃ­ estÃ¡ la magia."</strong></p>
                        </div>
                    </div>
                    
                    <div id="bloque5-game-2-container"></div>
                </div>
            </section>

            <!-- TeorÃ­a 3: Insight accionable -->
            <section class="chapter intro-scene-section" id="bloque5-theory-3" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ’¡ De datos a decisiones</h2>
                    
                    <div class="theory-card">
                        <div class="narrator-box">
                            <div class="narrator-icon">ğŸ“–</div>
                            <div class="narrator-text">
                                <p>Has reforzado conceptos clave:</p>
                                <ul style="text-align: left; margin-top: 1rem;">
                                    <li>Importancia de la coherencia en los triggers</li>
                                    <li>CÃ³mo la calidad del dato afecta directamente a la lectura</li>
                                    <li>Detectar errores de implementaciÃ³n antes de que corrompan anÃ¡lisis</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 8px; margin: 2rem 0; border-left: 4px solid var(--primary-color);">
                            <h3 style="margin-bottom: 1rem;">ğŸ¯ Ahora el siguiente nivel:</h3>
                            <p style="font-size: 1.1rem;">Dejas de ser tÃ©cnico y pasas a ser <strong>estratega</strong>.</p>
                            <p style="margin-top: 1rem;">No basta con leer datos. Hay que conectarlos con <strong>acciones reales</strong>.</p>
                        </div>
                        
                        <button class="btn-continue" style="margin-top: 2rem;" onclick="startBloque5Game3()">
                            Continuar: Generar insights â†’
                        </button>
                    </div>
                </div>
            </section>

            <!-- MisiÃ³n 3: Insight accionable -->
            <section class="chapter intro-scene-section" id="bloque5-game-3" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ¯ MisiÃ³n 3: Del dato a la acciÃ³n</h2>
                    
                    <div class="narrator-box">
                        <div class="narrator-icon">ğŸ“–</div>
                        <div class="narrator-text">
                            <p>Un marketer que sabe leer datos es valioso.</p>
                            <p>Un marketer que sabe convertir datos en acciones es <strong>imprescindible</strong>.</p>
                        </div>
                    </div>
                    
                    <div id="bloque5-game-3-container"></div>
                </div>
            </section>

            <!-- TeorÃ­a 4: El dashboard como relato -->
            <section class="chapter intro-scene-section" id="bloque5-theory-4" style="display: none;">
                <div class="narrative center-content">
                    <h2>ğŸ“Š El dashboard como relato</h2>
                    
                    <div class="theory-card">
                        <div class="narrator-box">
                            <div class="narrator-icon">ğŸ“–</div>
                            <div class="narrator-text">
                                <p>"Un dashboard no es una hoja de cÃ¡lculo bonita."</p>
                                <p><strong>"Es un guion que cuenta una historia."</strong></p>
                            </div>
                        </div>
                        
                        <div style="margin: 2rem 0;">
                            <h3 style="margin-bottom: 1.5rem;">âœ… QuÃ© hace bueno a un dashboard:</h3>
                            
                            <div style="display: grid; gap: 1rem;">
                                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                                    <h4>1ï¸âƒ£ Tiene una pregunta clara que responde</h4>
                                    <p style="color: var(--text-light); margin-top: 0.5rem;">No "muestra todos los datos", sino que responde a UNA pregunta especÃ­fica del negocio.</p>
                                </div>
                                
                                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #4ecdc4;">
                                    <h4>2ï¸âƒ£ Usa pocas mÃ©tricas, pero bien escogidas</h4>
                                    <p style="color: var(--text-light); margin-top: 0.5rem;">Menos es mÃ¡s. 4-5 mÃ©tricas clave dicen mÃ¡s que 50 nÃºmeros sin contexto.</p>
                                </div>
                                
                                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ff6b9d;">
                                    <h4>3ï¸âƒ£ Es entendible por alguien no tÃ©cnico</h4>
                                    <p style="color: var(--text-light); margin-top: 0.5rem;">Si tu CEO no lo entiende en 10 segundos, no funciona.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--accent-red); color: white; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                            <h3 style="margin-bottom: 1rem;">âš”ï¸ Boss Fight Final</h3>
                            <p>Es momento de demostrar que puedes crear un dashboard que cuente una historia clara.</p>
                            <p style="margin-top: 1rem;">El CEO te pregunta: <strong>"Â¿QuÃ© campaÃ±as estÃ¡n funcionando?"</strong></p>
                            <p style="margin-top: 0.5rem; font-style: italic;">Tu dashboard debe responder esa pregunta sin ambigÃ¼edades.</p>
                        </div>
                        
                        <button class="btn-primary" style="margin-top: 2rem; width: 100%;" onclick="startBloque5BossFight()">
                            âš”ï¸ Comenzar Boss Fight Final â†’
                        </button>
                    </div>
                </div>
            </section>

            <!-- Boss Fight: Dashboard -->
            <section class="chapter intro-scene-section" id="bloque5-boss-fight" style="display: none;">
                <div class="narrative center-content">
                    <h2>âš”ï¸ Boss Fight: Tu primer dashboard</h2>
                    
                    <div id="bloque5-boss-fight-container"></div>
                </div>
            </section>

            <!-- Cierre del Bloque 5 -->
            <section class="chapter intro-scene-section" id="bloque5-final" style="display: none;">
                <div class="narrative center-content">
                    <h1 style="font-size: 2.5rem; margin-bottom: 2rem;">ğŸ§ Bloque 5 Completado</h1>
                    
                    <div class="narrator-box">
                        <div class="narrator-icon">ğŸŒŸ</div>
                        <div class="narrator-text">
                            <p>Ya no oyes ruido blanco.</p>
                            <p><strong>Oyes patrones. Oyes problemas y oportunidades. Oyes historias.</strong></p>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
                        <h3 style="margin-bottom: 1.5rem;">ğŸ“Œ Lo que has aprendido:</h3>
                        <ul style="text-align: left; line-height: 2;">
                            <li>âœ… GTM es solo el medio: <strong>el fin es entender</strong></li>
                            <li>âœ… Un marketer que escucha al dato es un marketer mÃ¡s potente</li>
                            <li>âœ… Saber leer los flujos de datos te permite no depender ciegamente de otros</li>
                            <li>âœ… <strong>Medir fue el primer paso. Interpretarâ€¦ es lo que marca la diferencia.</strong></li>
                        </ul>
                    </div>
                    
                    <button class="btn-primary" style="margin-top: 2rem; font-size: 1.2rem;" onclick="startBloque6()">
                        ğŸ‘‰ Siguiente: Server-side GTM â†’
                    </button>
                </div>
            </section>

<!-- ============================================ -->
<!-- BLOQUE 6 â€” SERVER-SIDE GTM -->
<!-- ============================================ -->

<!-- Bienvenida Bloque 6 -->
<section class="chapter intro-scene-section" id="bloque6-welcome" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ”’ Bloque 6 â€” Server-side GTM</h1>
        <p style="text-align: center;"><span class="intro-pill" style="background: rgba(0, 200, 83, 0.15); color: var(--text);">â±ï¸ ~45 min</span></p>
        
        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ”®</div>
            <div class="narrator-text">
                <p><strong>El futuro del tracking ya estÃ¡ aquÃ­.</strong></p>
                <p>Con la muerte de las cookies, los ad-blockers y las restricciones de privacidad, el tracking client-side cada vez funciona peor.</p>
                <p><strong>Server-side GTM es la respuesta:</strong> mÃ¡s control, mejor atribuciÃ³n, mÃ¡s privacidad.</p>
            </div>
        </div>

        <div class="intro-grid-3" style="margin-top: var(--space-lg);">
            <article class="intro-card-motion" style="border-left: 4px solid #f44336;">
                <h3>âŒ El Problema</h3>
                <p>Ad-blockers, Safari ITP, iOS 14.5+ bloquean el tracking tradicional.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">Pierdes hasta 40% de conversiones.</p>
            </article>
            <article class="intro-card-motion" style="border-left: 4px solid #4caf50;">
                <h3>âœ… La SoluciÃ³n</h3>
                <p>Server-side envÃ­a datos desde TU servidor, no del navegador del usuario.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">Recuperas conversiones perdidas.</p>
            </article>
            <article class="intro-card-motion" style="border-left: 4px solid #2196f3;">
                <h3>ğŸ¯ El Resultado</h3>
                <p>Mejor Event Match Quality, mejores audiencias, mejor ROAS.</p>
                <p style="font-size: 0.85rem; color: var(--text-light);">Tus campaÃ±as optimizan mejor.</p>
            </article>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque6Theory1()">
            Entender la arquitectura â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 1: Client-side vs Server-side -->
<section class="chapter intro-scene-section" id="bloque6-theory-1" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ—ï¸ Arquitectura: Client vs Server</h2>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“–</div>
            <div class="narrator-text">
                <h3>La GuÃ­a dice:</h3>
                <p><strong>Antes:</strong> Todo pasaba en el navegador. Scripts cargaban, cookies se escribÃ­an, datos se enviaban desde el cliente.</p>
                <p><strong>Ahora:</strong> El navegador solo envÃ­a datos a TU servidor, y TU servidor se comunica con las plataformas (Meta, Google, etc.).</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg); margin-top: var(--space-lg);">
            
            <!-- Client-side -->
            <div style="background: rgba(244, 67, 54, 0.05); border: 2px solid #f44336; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #f44336; margin-top: 0;">âŒ Client-side (Tradicional)</h3>
                <pre style="background: #1a1a1a; color: #fff; padding: 1rem; border-radius: 8px; font-size: 0.8rem; overflow-x: auto;">
Usuario â†’ Navegador â†’ [Scripts] 
                    â†“
              Facebook Pixel
              Google Analytics
              TikTok Pixel
              ...etc</pre>
                
                <h4 style="margin-top: var(--space-md);">Problemas:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li>ğŸš« Ad-blockers bloquean scripts</li>
                    <li>ğŸš« Safari ITP limita cookies a 7 dÃ­as</li>
                    <li>ğŸš« iOS pide permiso (50% dice no)</li>
                    <li>ğŸš« Performance: muchos scripts = web lenta</li>
                    <li>ğŸš« Seguridad: todo visible en el navegador</li>
                </ul>
            </div>

            <!-- Server-side -->
            <div style="background: rgba(76, 175, 80, 0.05); border: 2px solid #4caf50; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #4caf50; margin-top: 0;">âœ… Server-side (Moderno)</h3>
                <pre style="background: #1a1a1a; color: #4fda7f; padding: 1rem; border-radius: 8px; font-size: 0.8rem; overflow-x: auto;">
Usuario â†’ Navegador â†’ [1 Script]
                    â†“
              TU SERVIDOR (GTM SS)
                    â†“
              Facebook CAPI
              GA4 MP
              TikTok Events API
              ...etc</pre>
                
                <h4 style="margin-top: var(--space-md);">Ventajas:</h4>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li>âœ… Ad-blockers no bloquean tu servidor</li>
                    <li>âœ… Cookies first-party (sin lÃ­mite ITP)</li>
                    <li>âœ… Performance: solo 1 script en cliente</li>
                    <li>âœ… Seguridad: API keys ocultas en servidor</li>
                    <li>âœ… Control total de los datos</li>
                </ul>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque6Theory2()">
            Ver cÃ³mo funciona GTM Server â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 2: GTM Server Container -->
<section class="chapter intro-scene-section" id="bloque6-theory-2" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ–¥ï¸ GTM Server Container</h2>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ”§</div>
            <div class="narrator-text">
                <p><strong>Un GTM Server Container es un GTM que corre en un servidor en la nube.</strong></p>
                <p>Recibe datos desde el cliente (web/app), los procesa, y los envÃ­a a las plataformas destino.</p>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 2rem; background: rgba(33, 150, 243, 0.05); border: 2px solid #2196f3; padding: var(--space-lg); border-radius: 12px;">
            <h3 style="color: #2196f3; margin-top: 0;">ğŸ—ï¸ Componentes del Server Container:</h3>
            
            <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #2196f3;">1</span>
                    <div>
                        <strong>Clients (Clientes)</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Reciben datos entrantes. Ej: GA4 Client, Facebook Client, Custom Client.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #2196f3;">2</span>
                    <div>
                        <strong>Tags (Etiquetas)</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">EnvÃ­an datos a destinos. Ej: Meta CAPI Tag, GA4 Tag, HTTP Request Tag.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #2196f3;">3</span>
                    <div>
                        <strong>Triggers y Variables</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Igual que en GTM Web, pero con datos del evento recibido.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #2196f3;">4</span>
                    <div>
                        <strong>Hosting</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);"><a href="https://cloud.google.com/run" target="_blank" rel="noopener noreferrer">Google Cloud Run</a>, AWS, o servicios como <a href="https://stape.io" target="_blank" rel="noopener noreferrer">Stape.io</a> / <a href="https://addingwell.com" target="_blank" rel="noopener noreferrer">Addingwell</a>.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ’¡</div>
            <div class="narrator-text">
                <h4 style="margin-top: 0;">Opciones de hosting:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                    <div style="background: rgba(255,255,255,0.5); padding: var(--space-md); border-radius: 8px;">
                        <strong>Google Cloud Run</strong>
                        <p style="font-size: 0.85rem; margin: 0.5rem 0 0;">Oficial de Google. ~$50-200/mes para trÃ¡fico medio.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.5); padding: var(--space-md); border-radius: 8px;">
                        <strong><a href="https://stape.io" target="_blank" rel="noopener noreferrer">Stape.io</a></strong>
                        <p style="font-size: 0.85rem; margin: 0.5rem 0 0;">Managed service. Desde $20/mes. MÃ¡s fÃ¡cil.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.5); padding: var(--space-md); border-radius: 8px;">
                        <strong><a href="https://addingwell.com" target="_blank" rel="noopener noreferrer">Addingwell</a></strong>
                        <p style="font-size: 0.85rem; margin: 0.5rem 0 0;">Europeo, GDPR-friendly. Desde â‚¬30/mes.</p>
                    </div>
                </div>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque6Theory3()">
            Ver caso real: Meta CAPI â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 3: Meta CAPI en detalle -->
<section class="chapter intro-scene-section" id="bloque6-theory-3" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ“˜ Caso Real: Meta CAPI</h2>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ“Š</div>
            <div class="narrator-text">
                <p><strong>Meta Conversions API (CAPI)</strong> es la forma de enviar eventos a Facebook/Instagram desde tu servidor.</p>
                <p>Es el ejemplo perfecto de por quÃ© server-side importa para marketing.</p>
            </div>
        </div>

        <div style="background: rgba(24, 119, 242, 0.05); border: 2px solid #1877f2; padding: var(--space-lg); border-radius: 12px; margin-top: var(--space-lg);">
            <h3 style="color: #1877f2; margin-top: 0;">ğŸ¯ Por quÃ© Meta recomienda CAPI:</h3>
            
            <div class="intro-grid-3" style="margin-top: var(--space-md);">
                <article class="intro-card-motion">
                    <h4>ğŸ“ˆ Mejor AtribuciÃ³n</h4>
                    <p style="font-size: 0.9rem;">Los eventos llegan aunque el usuario tenga ad-blocker o Safari.</p>
                </article>
                <article class="intro-card-motion">
                    <h4>ğŸ¯ Mejor Event Match Quality</h4>
                    <p style="font-size: 0.9rem;">Puedes enviar email hasheado, telÃ©fono, user_id para mejor matching.</p>
                </article>
                <article class="intro-card-motion">
                    <h4>ğŸ’° Mejor ROAS</h4>
                    <p style="font-size: 0.9rem;">MÃ¡s conversiones = mejor optimizaciÃ³n = mejor rendimiento de ads.</p>
                </article>
            </div>
        </div>

        <div class="mission-box" style="margin-top: 2rem; background: rgba(0, 200, 83, 0.05); border: 2px solid #00c853; padding: var(--space-lg); border-radius: 12px;">
            <h3 style="color: #00c853; margin-top: 0;">ğŸ”§ ConfiguraciÃ³n tÃ­pica:</h3>
            
            <div style="display: grid; gap: var(--space-md); margin-top: var(--space-md);">
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">1</span>
                    <div>
                        <strong>GTM Web: Enviar evento a Server Container</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Usar GA4 como "transport" al server container URL.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">2</span>
                    <div>
                        <strong>GTM Server: Recibir con GA4 Client</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">El cliente parsea la request y crea un event_data.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">3</span>
                    <div>
                        <strong>GTM Server: Tag de Meta CAPI</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Configurar Pixel ID, Access Token, mapear eventos.</p>
                    </div>
                </div>
                <div class="intro-step">
                    <span class="intro-step-bullet" style="background: #00c853;">4</span>
                    <div>
                        <strong>DeduplicaciÃ³n con event_id</strong>
                        <p style="font-size: 0.9rem; color: var(--text-light);">Mismo event_id en Pixel y CAPI = Meta sabe que es el mismo.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">âš ï¸</div>
            <div class="narrator-text">
                <h4 style="margin-top: 0; color: #ff9800;">Puntos clave a recordar:</h4>
                <ul style="margin: var(--space-sm) 0; padding-left: 1.25rem;">
                    <li><strong>HÃ­brido es mejor:</strong> Pixel + CAPI juntos (redundancia)</li>
                    <li><strong>Deduplicar siempre:</strong> event_id idÃ©ntico en ambos</li>
                    <li><strong>EMQ &gt; 6.0:</strong> Enviar datos de usuario (hasheados) mejora matching</li>
                    <li><strong>Test Events:</strong> Usar la funciÃ³n de test en Meta antes de producciÃ³n</li>
                </ul>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="startBloque6Theory4()">
            Consent Mode y privacidad â†’
        </button>
    </div>
</section>

<!-- TeorÃ­a 4: Consent Mode y GDPR -->
<section class="chapter intro-scene-section" id="bloque6-theory-4" style="display: none;">
    <div class="narrative center-content">
        <h2 style="text-align: center;">ğŸ›¡ï¸ Consent Mode y Privacidad</h2>

        <div class="narrator-box" style="margin-top: 2rem;">
            <div class="narrator-icon">âš–ï¸</div>
            <div class="narrator-text">
                <p><strong>Server-side no significa "saltarse la privacidad".</strong></p>
                <p>Al contrario: te da mÃ¡s control para cumplir GDPR/CCPA correctamente.</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-lg); margin-top: var(--space-lg);">
            
            <div style="background: rgba(156, 39, 176, 0.05); border: 2px solid #9c27b0; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #9c27b0; margin-top: 0;">ğŸª Google Consent Mode v2</h3>
                <p style="font-size: 0.9rem;">Obligatorio en UE desde marzo 2024.</p>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li><code>ad_storage</code> - Cookies de ads</li>
                    <li><code>analytics_storage</code> - Cookies analytics</li>
                    <li><code>ad_user_data</code> - Datos de usuario para ads</li>
                    <li><code>ad_personalization</code> - PersonalizaciÃ³n de ads</li>
                </ul>
            </div>

            <div style="background: rgba(33, 150, 243, 0.05); border: 2px solid #2196f3; padding: var(--space-lg); border-radius: 12px;">
                <h3 style="color: #2196f3; margin-top: 0;">ğŸ”’ Server-side + Consent</h3>
                <p style="font-size: 0.9rem;">El server puede:</p>
                <ul style="font-size: 0.9rem; padding-left: 1.25rem;">
                    <li>âœ… Verificar consent antes de enviar</li>
                    <li>âœ… Filtrar datos sensibles</li>
                    <li>âœ… Hashear PII automÃ¡ticamente</li>
                    <li>âœ… Logging de cumplimiento</li>
                </ul>
            </div>
        </div>

        <div class="narrator-box analogy" style="margin-top: 2rem;">
            <div class="narrator-icon">ğŸ’¡</div>
            <div class="narrator-text">
                <h4 style="margin-top: 0;">En resumen:</h4>
                <p>Server-side GTM te permite ser <strong>mÃ¡s preciso Y mÃ¡s respetuoso</strong> con la privacidad. No es una forma de evadir consentimiento, es una forma de gestionarlo mejor.</p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 2rem;" onclick="completeBloque6()">
            Completar Bloque 6 â†’
        </button>
    </div>
</section>

<!-- Final del Bloque 6 y del curso -->
<section class="chapter intro-scene-section" id="bloque6-final" style="display: none;">
    <div class="narrative center-content">
        <h1 style="font-size: 2.5rem; margin-bottom: 2rem;">ğŸ“ Â¡Aventura Completada!</h1>
        
        <div class="narrator-box">
            <div class="narrator-icon">ğŸŒŸ</div>
            <div class="narrator-text">
                <p>Has recorrido todo el camino.</p>
                <p>Desde "Â¿quÃ© es GTM?" hasta Server-side y privacidad.</p>
                <p><strong>Ya no eres un marketer que "usa herramientas". Eres un estratega de datos.</strong></p>
            </div>
        </div>
        
        <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
            <h3 style="margin-bottom: 1.5rem;">ğŸ“š Tu viaje completo:</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; text-align: center;">
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ¯</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>SecciÃ³n 0</strong><br>Â¿QuÃ© es GTM?</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ—ï¸</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 1</strong><br>La Torre</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ—£ï¸</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 2</strong><br>Eventos</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ‘ï¸</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 3</strong><br>ValidaciÃ³n</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ¬</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Demos</strong><br>GTM en AcciÃ³n</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ“Š</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 4</strong><br>Funnels</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ§</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 5</strong><br>Datos</p>
                </div>
                <div style="padding: 1rem;">
                    <span style="font-size: 2rem;">ğŸ”’</span>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;"><strong>Bloque 6</strong><br>Server-side</p>
                </div>
            </div>
        </div>
        
        <div style="background: linear-gradient(135deg, var(--primary), #4ecdc4); color: var(--text); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
                        <h3 style="margin-bottom: 1rem;">ğŸ‰ Â¡Felicidades!</h3>
                        <p style="font-size: 1.1rem;">Has completado <strong>La EvoluciÃ³n del Tagging</strong></p>
                        <p style="margin-top: 1rem;">De cero a marketer que entiende el dato.</p>
                        <p style="margin-top: 0.5rem;">De seguir instrucciones a tomar decisiones estratÃ©gicas.</p>
                        <p style="margin-top: 0.5rem; font-weight: bold;">De tÃ©cnico a estratega.</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 3rem;">
            <button class="btn-primary" onclick="toggleAchievements()">
                            ğŸ† Ver todos los logros
                        </button>
                        <button class="btn-secondary" onclick="restart()">
                            ğŸ”„ Volver al inicio
                        </button>
                    </div>
                </div>
            </section>

        </article>

    </div>

    <!-- Floating Teacher Mode Button -->
    <button id="teacher-mode-toggle" class="floating-btn" onclick="toggleTeacherMode()" title="Modo Presentador (T)">
        ğŸ“
    </button>

    <!-- Styles -->
    <link rel="stylesheet" href="/css/main.css?v=117">
    <link rel="stylesheet" href="/css/modern-theme.css">
</head>
<body>
    <!-- Scripts -->
    <script is:inline src="/js/lib/minpubsub.src.js"></script>
    <script is:inline src="/js/lib/tweenjs-0.6.2.min.js"></script>
    <script is:inline src="/js/lib/helpers.js"></script>
    <script is:inline src="/js/content-theory.js?v=5"></script>
    <script is:inline src="/js/game-system.js?v=4"></script>
    <script is:inline src="/js/minigames.js?v=15"></script>
    <script is:inline src="/js/bloque2-minigames.js?v=4000"></script>
    <script is:inline src="/js/secretos-checklist.js?v=3"></script>
    <script is:inline src="/js/bloque3-minigames.js?v=100"></script>
    <script is:inline src="/js/bloque4-minigames.js?v=100"></script>
    <script is:inline src="/js/bloque5-minigames.js?v=1"></script>
    <script is:inline src="/js/canvas.js?v=22"></script>
    <script is:inline src="/js/archivist-game.js"></script>
    <script is:inline src="/js/pantry-game.js"></script>
    <script is:inline src="/js/main.js?v=2005"></script>
</body>
</html>

